<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.376">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Computational Methods in R - 6&nbsp; Homework 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./assignments.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./assignments.html">Assignments</a></li><li class="breadcrumb-item"><a href="./hw1.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Homework 1</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./assignments.html">Assignments</a></li><li class="breadcrumb-item"><a href="./hw1.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Homework 1</span></a></li></ol></nav><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title"><span id="sec-hw1" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Homework 1</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Computational Methods in R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./course-notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./beyond-dataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Beyond Dataframes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./using-and-building-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Using and Building Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./permutation-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Permutation Tests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bootstrap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bootstrap</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./computational-experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Computational Experiments</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./assignments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hw1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Homework 1</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#assignment" id="toc-assignment" class="nav-link active" data-scroll-target="#assignment"><span class="header-section-number">6.1</span> Assignment</a>
  <ul class="collapse">
<li><a href="#gather-simulated-gamma-data" id="toc-gather-simulated-gamma-data" class="nav-link" data-scroll-target="#gather-simulated-gamma-data"><span class="header-section-number">6.1.1</span> Gather simulated gamma data</a></li>
  <li><a href="#compute-means-and-confidence-intervals" id="toc-compute-means-and-confidence-intervals" class="nav-link" data-scroll-target="#compute-means-and-confidence-intervals"><span class="header-section-number">6.1.2</span> Compute means and confidence intervals</a></li>
  </ul>
</li>
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice"><span class="header-section-number">6.2</span> Practice</a></li>
  <li>
<a href="#solution" id="toc-solution" class="nav-link" data-scroll-target="#solution"><span class="header-section-number">6.3</span> Solution</a>
  <ul class="collapse">
<li><a href="#gather-simulated-gamma-data-1" id="toc-gather-simulated-gamma-data-1" class="nav-link" data-scroll-target="#gather-simulated-gamma-data-1"><span class="header-section-number">6.3.1</span> Gather simulated gamma data</a></li>
  <li><a href="#compute-means-and-confidence-intervals-1" id="toc-compute-means-and-confidence-intervals-1" class="nav-link" data-scroll-target="#compute-means-and-confidence-intervals-1"><span class="header-section-number">6.3.2</span> Compute means and confidence intervals</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><section id="assignment" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="assignment">
<span class="header-section-number">6.1</span> Assignment</h2>
<p>Your task for this week is simple in concept but challenging to code efficiently. You need to simulate samples from gamma distributions using different sample sizes, different shape parameters and different scale parameters. You will then use these simulated values to compute sample means and 95% Confidence Intervals (for the population mean) for each of the samples that you simulated. You <strong><em>must</em></strong> do so by building the set of functions and set of data objects that match the details in the steps below.</p>
<section id="gather-simulated-gamma-data" class="level3" data-number="6.1.1"><h3 data-number="6.1.1" class="anchored" data-anchor-id="gather-simulated-gamma-data">
<span class="header-section-number">6.1.1</span> Gather simulated gamma data</h3>
<p>First part:</p>
<p>Build a function named <code>sim_gam</code> that has formal arguments for sample size (n), the vector of shapes (length M), the vector of scales (length L). Also include an argument that will allow the user to add a random seed number for reproducible simulation, but ignore if not specified. The body of you function must use these arguments to generate a 3-dimensional array of simulated values from a gamma distribution. The size and indexing in each dimension in this array should be (n) by (M) by (L).</p>
<p>Your array should also have the “dimnames” attribute of the array added for the shape and scale dimensions that contain labels related to the parameter values that those dimensions represent.</p>
<p>Second part:</p>
<p>Use your gamma simulation function to create a list of arrays called <code>gam_arrays_list</code> with the following attributes:</p>
<ul>
<li><p>All arrays should include results for <code>shape_vec = c(0.1, 1, 10, 100)</code> and <code>scale_vec = c(0.1, 1, 10, 100)</code></p></li>
<li><p>Each array will represent a different sample size: <code>n = c(25, 50, 75, 100, 500,1000)</code></p></li>
</ul></section><section id="compute-means-and-confidence-intervals" class="level3" data-number="6.1.2"><h3 data-number="6.1.2" class="anchored" data-anchor-id="compute-means-and-confidence-intervals">
<span class="header-section-number">6.1.2</span> Compute means and confidence intervals</h3>
<p>First part:</p>
<p>Next build the following two functions that the output array from the gamma data simulator above, as their inputs: 1. A function named <code>gam_means</code> that returns an (M) by (L) matrix of means from the simulated values from each shape and scale parameter pair.</p>
<ol start="2" type="1">
<li>A function named <code>gam_CIs</code> that returns a (2) by (M) by (L) array containing the lower and upper confidence bounds for the 95% confidence intervals for the means of each simulated gamma sample.</li>
</ol>
<p>Hints</p>
<ul>
<li><p>Check out the <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> function help documentatio.n</p></li>
<li><p>You will likely need a helper function within your <code>gam_CIs</code> function that can take in a sample vector and return the 95% Confidence Interval as a vector of c(lower.val, upper.val). I suggest looking at the results of the <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code> function for some prebuilt access to 95% CI for means.</p></li>
</ul>
<p>Second part:</p>
<p>Apply your <code>gam_means()</code> function to your simulated data in <code>gam_arrays_list</code>. Store the results as list of means matrices</p>
<p>Also, apply your <code>gam_CIs()</code> function to your simulated data in <code>gam_arrays_list</code>. Store the results an additional list of Confidence Interval arrays.</p>
</section></section><section id="practice" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="practice">
<span class="header-section-number">6.2</span> Practice</h2>
<p>Here are some demos of working with simple examples to see how APPLY statements and MAP statements work on data types (matrix vs dataframe).</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># investigate data types and vectorized results</span></span>
<span></span>
<span><span class="co"># example 2D dataset as different data structure</span></span>
<span><span class="va">data_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">200</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">data_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">data_mat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop over columns to find means</span></span>
<span></span>
<span><span class="co"># BEST WAY</span></span>
<span><span class="co"># -&gt; should be zeros, works for both types</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data_mat</span>, MARGIN <span class="op">=</span> <span class="fl">2</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.05400396 -0.05404391  0.11716543  0.04152527  0.03911136</code></pre>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">data_df</span>, <span class="va">mean</span><span class="op">)</span> <span class="co"># works because each column in a dataframe is like a list and simplifies result</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         X1          X2          X3          X4          X5 
-0.05400396 -0.05404391  0.11716543  0.04152527  0.03911136 </code></pre>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         X1          X2          X3          X4          X5 
-0.05400396 -0.05404391  0.11716543  0.04152527  0.03911136 </code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># OTHER CORRECT WAYS</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">data_mat</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">data_mat</span><span class="op">[</span>,<span class="va">X</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.05400396 -0.05404391  0.11716543  0.04152527  0.03911136</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data_df</span>, MARGIN <span class="op">=</span> <span class="fl">2</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         X1          X2          X3          X4          X5 
-0.05400396 -0.05404391  0.11716543  0.04152527  0.03911136 </code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">data_df</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">data_df</span><span class="op">[</span>,<span class="va">X</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.05400396 -0.05404391  0.11716543  0.04152527  0.03911136</code></pre>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">data_df</span>, <span class="va">mean</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$X1
[1] -0.05400396

$X2
[1] -0.05404391

$X3
[1] 0.1171654

$X4
[1] 0.04152527

$X5
[1] 0.03911136</code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_vec</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span> <span class="co"># know returning data type, so should use _dbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         X1          X2          X3          X4          X5 
-0.05400396 -0.05404391  0.11716543  0.04152527  0.03911136 </code></pre>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span> <span class="co"># reduce cause map() returns a list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.05400396 -0.05404391  0.11716543  0.04152527  0.03911136</code></pre>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># INCORRECT WAYS</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">data_mat</span>, <span class="va">mean</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="co"># this takes each individual value and returns the mean (so the same value)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0.47396250 -0.55306786  0.35162823 -0.76858673 -2.28475143 -0.10665379
 [7] -0.71853290 -0.44057683  1.22256012 -1.05750451  0.13752910 -0.04898068
[13]  0.70449112  0.87378153 -0.84670521 -0.74373214 -1.30336909  1.77780881
[19] -0.62932110  0.83923256</code></pre>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">data_mat</span>, <span class="va">mean</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">==</span> <span class="va">data_mat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data_mat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="co"># same thing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.4739625

[[2]]
[1] -0.5530679

[[3]]
[1] 0.3516282

[[4]]
[1] -0.7685867

[[5]]
[1] -2.284751

[[6]]
[1] -0.1066538</code></pre>
</div>
</div>
<p>Now investigate structure of data holder.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># this is just to make that we can correctly summarize over columns and layers of an array and keep index names for the result</span></span>
<span></span>
<span><span class="co"># fill example 2D dataset as a matrix</span></span>
<span><span class="va">data_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">20</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># change dimensions and add dimension label</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">data_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">data_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"y = "</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"z = "</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># summarize over rows: this averages over x for each combination of y and z</span></span>
<span><span class="co"># check result</span></span>
<span><span class="va">data_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">data_mat</span>, MARGIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">data_means</span><span class="op">[</span><span class="st">"y = 1"</span>, <span class="st">"z = 1"</span><span class="op">]</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">data_mat</span><span class="op">[</span> , <span class="st">"y = 1"</span>, <span class="st">"z = 1"</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Now apply confirmed results from above to a real scenario.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initial vectors</span></span>
<span><span class="co"># -&gt; i = obs ID, mu = mean and sigma = sd</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span> <span class="co"># not using n = 10 so that can set row names below</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># initialize an empty array (dim = i by mu by sigma) and change dimension labels</span></span>
<span><span class="va">data_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">data_sim</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"i"</span>, <span class="va">i</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"mu = "</span>, <span class="va">mu</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sigma = "</span>, <span class="va">sigma</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># to generate the data in the best way, need to be saving just the results from the iterations i, and double for loop to access the different columns (mean) and layers (sd) like in the notes for beyond dataframe</span></span>
<span></span>
<span><span class="co"># vectorize over the means to create a matrix of obs from each mean</span></span>
<span><span class="co"># then use a for loop to loop over the different standard deviation (as the third dimension)</span></span>
<span><span class="co"># (use the holding structure 'data' that is create at beginning of this section)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data_sim</span><span class="op">[</span> , <span class="va">j</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, mean <span class="op">=</span> <span class="va">mu</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># now confirm that the summaries match the parameters</span></span>
<span><span class="va">data_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">data_sim</span>, MARGIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">data_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">data_sim</span>, MARGIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">sd</span><span class="op">)</span></span>
<span><span class="va">data_means</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          sigma = 0.5  sigma = 5
mu = 0    -0.06373573   1.397530
mu = 5     5.07286903   4.643620
mu = 10   10.08404702   9.772814
mu = 100 100.18075617 101.300889
mu = 500 500.11772703 497.297924</code></pre>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_sd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         sigma = 0.5 sigma = 5
mu = 0     0.4303220  4.238961
mu = 5     0.4062227  4.895236
mu = 10    0.7479058  4.296652
mu = 100   0.5462804  5.341503
mu = 500   0.4054104  3.440882</code></pre>
</div>
</div>
</section><section id="solution" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="solution">
<span class="header-section-number">6.3</span> Solution</h2>
<section id="gather-simulated-gamma-data-1" class="level3" data-number="6.3.1"><h3 data-number="6.3.1" class="anchored" data-anchor-id="gather-simulated-gamma-data-1">
<span class="header-section-number">6.3.1</span> Gather simulated gamma data</h3>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># define function to create an array [sample size (n) x # of shapes (M) x # of scales (L)] of simulated data from a gamma distribution</span></span>
<span><span class="co"># -&gt; arguments: n = sample size (integer), M = shape parameters (numeric vector), scale parameters (numeric vector), seed to set (integer)</span></span>
<span><span class="co"># -&gt; returns: n x M x L array</span></span>
<span><span class="va">sim_gam</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sample_size</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">shapes</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">scales</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">seed</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># conditionally set the random seed</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># initialize an empty array (dim = n by shape by scale) and change main dimension labels</span></span>
<span>  <span class="va">data_sim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">sample_size</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sample_size</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">data_sim</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"shape = "</span>, <span class="va">shapes</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"scale = "</span>, <span class="va">scales</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># generate data from the specified shape and scale combination using nested for loops</span></span>
<span>  <span class="co"># NOTE: there are different ways to do this with either two sapply() statements or a for loop with a sapply</span></span>
<span>  <span class="co"># -&gt; but this is makes the most logical sense: fill each layer column by column rather than fill one layer "in bulk"</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">scales</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">shapes</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">data_sim</span><span class="op">[</span> , <span class="va">j</span>, <span class="va">k</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">sample_size</span>, shape <span class="op">=</span> <span class="va">shapes</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, scale <span class="op">=</span> <span class="va">scales</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">data_sim</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The body from the above implementation is where we generate the data is equivalent to the following if we wanted to use an APPLY statement.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="co"># equivalent to:</span></span>
<span>  <span class="co"># use an inner sapply() to fill the entire layer with one function call (sapply() then does it shape by shape column at a time) rather than column by column loop for changing layer</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">scales</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="co"># generate the random numbers according to the scales (changes by matrix) and the shapes (changes by column within matrix)</span></span>
<span>    <span class="va">data_sim</span><span class="op">[</span> , , <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">shapes</span>, <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">sample_size</span>, shape <span class="op">=</span> <span class="va">X</span>, scale <span class="op">=</span> <span class="va">scales</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now with the function defined, we can generate the data.</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initial vectors of the changing parameters for generating data</span></span>
<span><span class="va">sample_sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">shape_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">scale_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate data</span></span>
<span><span class="co"># add dimension labels for the sample sizes</span></span>
<span><span class="va">gam_arrays_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">sample_sizes</span>, <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="fu">sim_gam</span><span class="op">(</span>sample_size <span class="op">=</span> <span class="va">X</span>, shapes <span class="op">=</span> <span class="va">shape_vec</span>, scales <span class="op">=</span> <span class="va">scale_vec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">gam_arrays_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"n = "</span>, <span class="va">sample_sizes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">gam_arrays_list</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ n = 25  : num [1:25, 1:4, 1:4] 8.55e-05 6.33e-06 7.80e-08 4.98e-05 1.97e-07 ...
  ..- attr(*, "dimnames")=List of 3
  .. ..$ : NULL
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 50  : num [1:50, 1:4, 1:4] 2.52e-02 1.43e-02 1.98e-06 1.78e-08 1.04e-02 ...
  ..- attr(*, "dimnames")=List of 3
  .. ..$ : NULL
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 75  : num [1:75, 1:4, 1:4] 1.31e-05 3.77e-13 2.26e-08 4.55e-15 5.52e-04 ...
  ..- attr(*, "dimnames")=List of 3
  .. ..$ : NULL
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 100 : num [1:100, 1:4, 1:4] 6.25e-06 1.07e-04 9.08e-17 1.69e-04 2.12e-08 ...
  ..- attr(*, "dimnames")=List of 3
  .. ..$ : NULL
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 500 : num [1:500, 1:4, 1:4] 1.22e-03 5.13e-02 1.97e-07 4.20e-02 6.54e-03 ...
  ..- attr(*, "dimnames")=List of 3
  .. ..$ : NULL
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 1000: num [1:1000, 1:4, 1:4] 6.21e-02 4.90e-03 8.46e-03 5.20e-07 8.84e-03 ...
  ..- attr(*, "dimnames")=List of 3
  .. ..$ : NULL
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"</code></pre>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">gam_arrays_list</span><span class="op">$</span><span class="va">`n = 25`</span><span class="op">[</span>, , <span class="fl">1</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      shape = 0.1 shape = 1 shape = 10 shape = 100
 [1,]       0.000     0.014      1.019       9.833
 [2,]       0.000     0.096      1.391       9.837
 [3,]       0.000     0.016      1.123      11.214
 [4,]       0.000     0.121      1.494       9.199
 [5,]       0.000     0.073      1.077      10.242
 [6,]       0.076     0.025      0.998      10.080
 [7,]       0.009     0.225      1.069       8.681
 [8,]       0.010     0.034      0.656       9.161
 [9,]       0.000     0.006      1.308       8.565
[10,]       0.000     0.011      1.324      10.208
[11,]       0.008     0.090      0.782       8.785
[12,]       0.000     0.004      0.963       9.483
[13,]       0.024     0.166      0.704      10.095
[14,]       0.000     0.150      1.433       9.328
[15,]       0.000     0.049      0.944       9.357
[16,]       0.013     0.148      1.364       9.614
[17,]       0.000     0.030      0.972      10.391
[18,]       0.001     0.129      1.051       8.613
[19,]       0.003     0.008      1.031      10.914
[20,]       0.000     0.065      0.546       8.885
[21,]       0.058     0.020      1.099       9.876
[22,]       0.000     0.076      0.767      11.827
[23,]       0.037     0.087      1.811       8.764
[24,]       0.000     0.056      0.683      10.997
[25,]       0.012     0.037      0.797      10.553</code></pre>
</div>
</div>
</section><section id="compute-means-and-confidence-intervals-1" class="level3" data-number="6.3.2"><h3 data-number="6.3.2" class="anchored" data-anchor-id="compute-means-and-confidence-intervals-1">
<span class="header-section-number">6.3.2</span> Compute means and confidence intervals</h3>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># define function to calculate the mean of the simulated observations for each combination of shape and scale</span></span>
<span><span class="co"># -&gt; argument: n x M x L array of simulated values</span></span>
<span><span class="co"># -&gt; returns: M x L matrix of column means from each layer</span></span>
<span><span class="va">gam_means</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">gam_array</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">gam_array</span>, MARGIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># function to get CIs for each combination of shape and scale parameters</span></span>
<span><span class="co"># -&gt; argument: n x M x L array of simulated values</span></span>
<span><span class="co"># -&gt; returns: 2 x M x L array of confidence interval bounds for each column of each layer</span></span>
<span><span class="va">gam_CIs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">gam_array</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># run a t-test for each combination of shape and scale values</span></span>
<span>  <span class="va">t_tests</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">gam_array</span>, MARGIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">t.test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># extract the CI bounds for the mean of the samples</span></span>
<span>  <span class="va">ci_bounds</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">t_tests</span>, MARGIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="va">t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">conf.int</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># add rownames for each matrix to indicate which CI bound it is</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">ci_bounds</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lower bound"</span>, <span class="st">"upper bound"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># return array</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ci_bounds</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># (multiple ways to) create a list of arrays containing the means for each sample of the generated data</span></span>
<span><span class="co"># use lapply to keep as list and not simplify to matrix</span></span>
<span><span class="va">gam_x_bars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">gam_arrays_list</span>, <span class="va">gam_means</span><span class="op">)</span> <span class="co"># equivalent to: lapply(X = gam_arrays_list, FUN = function(X) gam_means(X))</span></span>
<span><span class="va">gam_x_bars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">gam_arrays_list</span>, \<span class="op">(</span><span class="va">array</span><span class="op">)</span> <span class="fu">gam_means</span><span class="op">(</span><span class="va">array</span><span class="op">)</span><span class="op">)</span> <span class="co"># more readable</span></span>
<span></span>
<span><span class="co"># create a list of arrays containing the confidence interval bounds for the mean of each sample of the generated data</span></span>
<span><span class="va">gam_ci_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">gam_arrays_list</span>, \<span class="op">(</span><span class="va">array</span><span class="op">)</span> <span class="fu">gam_CIs</span><span class="op">(</span><span class="va">array</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">gam_x_bars</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ n = 25  : num [1:4, 1:4] 0.01 0.0695 1.0562 9.7801 0.0475 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 50  : num [1:4, 1:4] 0.00405 0.10392 1.02116 9.97883 0.08361 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 75  : num [1:4, 1:4] 0.0125 0.0954 1.0022 10.078 0.0859 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 100 : num [1:4, 1:4] 0.0075 0.1085 1.0555 10.0528 0.1657 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 500 : num [1:4, 1:4] 0.0111 0.0954 0.9875 10.0186 0.0797 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 1000: num [1:4, 1:4] 0.0112 0.1011 0.9871 9.9557 0.1007 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"</code></pre>
</div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gam_x_bars</span><span class="op">$</span><span class="va">`n = 25`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            scale = 0.1    scale = 1  scale = 10 scale = 100
shape = 0.1  0.01001787   0.04751898   0.7051746    12.78012
shape = 1    0.06949849   0.91883925   9.7653604   112.31653
shape = 10   1.05623999  10.09542504  92.9124727   985.30090
shape = 100  9.78008855 103.52050976 956.6786584 10364.17523</code></pre>
</div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">gam_ci_bounds</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ n = 25  : num [1:2, 1:4, 1:4] 0.00199 0.01805 0.04506 0.09394 0.9314 ...
  ..- attr(*, "dimnames")=List of 3
  .. ..$ : chr [1:2] "lower bound" "upper bound"
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 50  : num [1:2, 1:4, 1:4] 0.00185 0.00624 0.07613 0.13171 0.92321 ...
  ..- attr(*, "dimnames")=List of 3
  .. ..$ : chr [1:2] "lower bound" "upper bound"
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 75  : num [1:2, 1:4, 1:4] 0.00044 0.02463 0.07095 0.11984 0.92489 ...
  ..- attr(*, "dimnames")=List of 3
  .. ..$ : chr [1:2] "lower bound" "upper bound"
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 100 : num [1:2, 1:4, 1:4] 0.00282 0.01218 0.08727 0.12968 0.99306 ...
  ..- attr(*, "dimnames")=List of 3
  .. ..$ : chr [1:2] "lower bound" "upper bound"
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 500 : num [1:2, 1:4, 1:4] 0.00847 0.01366 0.08708 0.10373 0.95978 ...
  ..- attr(*, "dimnames")=List of 3
  .. ..$ : chr [1:2] "lower bound" "upper bound"
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"
 $ n = 1000: num [1:2, 1:4, 1:4] 0.00885 0.01353 0.09451 0.10775 0.9669 ...
  ..- attr(*, "dimnames")=List of 3
  .. ..$ : chr [1:2] "lower bound" "upper bound"
  .. ..$ : chr [1:4] "shape = 0.1" "shape = 1" "shape = 10" "shape = 100"
  .. ..$ : chr [1:4] "scale = 0.1" "scale = 1" "scale = 10" "scale = 100"</code></pre>
</div>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gam_ci_bounds</span><span class="op">$</span><span class="va">`n = 25`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , scale = 0.1

            shape = 0.1  shape = 1 shape = 10 shape = 100
lower bound 0.001988243 0.04506035  0.9314015    9.415955
upper bound 0.018047502 0.09393663  1.1810785   10.144222

, , scale = 1

            shape = 0.1 shape = 1 shape = 10 shape = 100
lower bound -0.01023031 0.6460409   8.887475    98.75415
upper bound  0.10526827 1.1916376  11.303375   108.28687

, , scale = 10

            shape = 0.1 shape = 1 shape = 10 shape = 100
lower bound   0.2265346  5.628111   79.98262    922.0426
upper bound   1.1838147 13.902610  105.84233    991.3147

, , scale = 100

            shape = 0.1 shape = 1 shape = 10 shape = 100
lower bound   -2.026462  77.09184   883.8548    9939.587
upper bound   27.586708 147.54122  1086.7470   10788.764</code></pre>
</div>
</div>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./assignments.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Assignments</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb45" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Homework 1 {#sec-hw1}</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-prereqs</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr options</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"_common.R"</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Assignment</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>Your task for this week is simple in concept but challenging to code efficiently. You need to simulate samples from gamma distributions using different sample sizes, different shape parameters and different scale parameters. You will then use these simulated values to compute sample means and 95% Confidence Intervals (for the population mean) for each of the samples that you simulated. You ***must*** do so by building the set of functions and set of data objects that match the details in the steps below.</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="fu">### Gather simulated gamma data</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>First part:</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>Build a function named <span class="in">`sim_gam`</span> that has formal arguments for sample size (n), the vector of shapes (length M), the vector of scales (length L). Also include an argument that will allow the user to add a random seed number for reproducible simulation, but ignore if not specified. The body of you function must use these arguments to generate a 3-dimensional array of simulated values from a gamma distribution. The size and indexing in each dimension in this array should be (n) by (M) by (L).</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>Your array should also have the "dimnames" attribute of the array added for the shape and scale dimensions that contain labels related to the parameter values that those dimensions represent.</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>Second part:</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>Use your gamma simulation function to create a list of arrays called <span class="in">`gam_arrays_list`</span> with the following attributes:</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All arrays should include results for <span class="in">`shape_vec = c(0.1, 1, 10, 100)`</span> and <span class="in">`scale_vec = c(0.1, 1, 10, 100)`</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Each array will represent a different sample size: <span class="in">`n = c(25, 50, 75, 100, 500,1000)`</span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="fu">### Compute means and confidence intervals</span></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>First part:</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>Next build the following two functions that the output array from the gamma data simulator above, as their inputs:</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>A function named <span class="in">`gam_means`</span> that returns an (M) by (L) matrix of means from the simulated values from each shape and scale parameter pair.</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>A function named <span class="in">`gam_CIs`</span> that returns a (2) by (M) by (L) array containing the lower and upper confidence bounds for the 95% confidence intervals for the means of each simulated gamma sample.</span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>Hints</span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check out the <span class="in">`apply()`</span> function help documentatio.n</span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You will likely need a helper function within your <span class="in">`gam_CIs`</span> function that can take in a sample vector and return the 95% Confidence Interval as a vector of c(lower.val, upper.val). I suggest looking at the results of the <span class="in">`t.test()`</span> function for some prebuilt access to 95% CI for means.</span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>Second part:</span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a>Apply your <span class="in">`gam_means()`</span> function to your simulated data in <span class="in">`gam_arrays_list`</span>. Store the results as list of means matrices</span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a>Also, apply your <span class="in">`gam_CIs()`</span> function to your simulated data in <span class="in">`gam_arrays_list`</span>. Store the results an additional list of Confidence Interval arrays.</span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practice </span></span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a>Here are some demos of working with simple examples to see how APPLY statements and MAP statements work on data types (matrix vs dataframe).</span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: apply-maps</span></span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a><span class="co"># investigate data types and vectorized results</span></span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a><span class="co"># example 2D dataset as different data structure</span></span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a>data_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>), <span class="at">nrow =</span> <span class="dv">200</span>, <span class="at">ncol =</span> <span class="dv">5</span>)</span>
<span id="cb45-71"><a href="#cb45-71" aria-hidden="true" tabindex="-1"></a>data_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data_mat)</span>
<span id="cb45-72"><a href="#cb45-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-73"><a href="#cb45-73" aria-hidden="true" tabindex="-1"></a><span class="co"># loop over columns to find means</span></span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a><span class="co"># BEST WAY</span></span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; should be zeros, works for both types</span></span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(<span class="at">X =</span> data_mat, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(data_df, mean) <span class="co"># works because each column in a dataframe is like a list and simplifies result</span></span>
<span id="cb45-79"><a href="#cb45-79" aria-hidden="true" tabindex="-1"></a>data_df <span class="sc">%&gt;%</span> <span class="fu">map_dbl</span>(mean)</span>
<span id="cb45-80"><a href="#cb45-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a><span class="co"># OTHER CORRECT WAYS</span></span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(data_mat), <span class="cf">function</span>(X) <span class="fu">mean</span>(data_mat[,X]))</span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(<span class="at">X =</span> data_df, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> mean)</span>
<span id="cb45-84"><a href="#cb45-84" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(data_df), <span class="cf">function</span>(X) <span class="fu">mean</span>(data_df[,X]))</span>
<span id="cb45-85"><a href="#cb45-85" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(data_df, mean)</span>
<span id="cb45-86"><a href="#cb45-86" aria-hidden="true" tabindex="-1"></a>data_df <span class="sc">%&gt;%</span> <span class="fu">map_vec</span>(mean) <span class="co"># know returning data type, so should use _dbl</span></span>
<span id="cb45-87"><a href="#cb45-87" aria-hidden="true" tabindex="-1"></a>data_df <span class="sc">%&gt;%</span> <span class="fu">map</span>(mean) <span class="sc">%&gt;%</span> <span class="fu">reduce</span>(c) <span class="co"># reduce cause map() returns a list</span></span>
<span id="cb45-88"><a href="#cb45-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-89"><a href="#cb45-89" aria-hidden="true" tabindex="-1"></a><span class="co"># INCORRECT WAYS</span></span>
<span id="cb45-90"><a href="#cb45-90" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">sapply</span>(data_mat, mean), <span class="at">n =</span> <span class="dv">20</span>) <span class="co"># this takes each individual value and returns the mean (so the same value)</span></span>
<span id="cb45-91"><a href="#cb45-91" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">sapply</span>(data_mat, mean), <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">==</span> data_mat[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span>]</span>
<span id="cb45-92"><a href="#cb45-92" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_mat <span class="sc">%&gt;%</span> <span class="fu">map</span>(mean)) <span class="co"># same thing</span></span>
<span id="cb45-93"><a href="#cb45-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-94"><a href="#cb45-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-95"><a href="#cb45-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-96"><a href="#cb45-96" aria-hidden="true" tabindex="-1"></a>Now investigate structure of data holder.</span>
<span id="cb45-97"><a href="#cb45-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-100"><a href="#cb45-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-101"><a href="#cb45-101" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: check structure</span></span>
<span id="cb45-102"><a href="#cb45-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-103"><a href="#cb45-103" aria-hidden="true" tabindex="-1"></a><span class="co"># this is just to make that we can correctly summarize over columns and layers of an array and keep index names for the result</span></span>
<span id="cb45-104"><a href="#cb45-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-105"><a href="#cb45-105" aria-hidden="true" tabindex="-1"></a><span class="co"># fill example 2D dataset as a matrix</span></span>
<span id="cb45-106"><a href="#cb45-106" aria-hidden="true" tabindex="-1"></a>data_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>), <span class="at">nrow =</span> <span class="dv">20</span>, <span class="at">ncol =</span> <span class="dv">5</span>)</span>
<span id="cb45-107"><a href="#cb45-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-108"><a href="#cb45-108" aria-hidden="true" tabindex="-1"></a><span class="co"># change dimensions and add dimension label</span></span>
<span id="cb45-109"><a href="#cb45-109" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data_mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb45-110"><a href="#cb45-110" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(data_mat) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">paste0</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="fu">paste0</span>(<span class="st">"y = "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), <span class="fu">paste0</span>(<span class="st">"z = "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span>
<span id="cb45-111"><a href="#cb45-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-112"><a href="#cb45-112" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize over rows: this averages over x for each combination of y and z</span></span>
<span id="cb45-113"><a href="#cb45-113" aria-hidden="true" tabindex="-1"></a><span class="co"># check result</span></span>
<span id="cb45-114"><a href="#cb45-114" aria-hidden="true" tabindex="-1"></a>data_means <span class="ot">&lt;-</span> <span class="fu">apply</span>(data_mat, <span class="at">MARGIN =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), mean)</span>
<span id="cb45-115"><a href="#cb45-115" aria-hidden="true" tabindex="-1"></a>data_means[<span class="st">"y = 1"</span>, <span class="st">"z = 1"</span>] <span class="sc">==</span> <span class="fu">mean</span>(data_mat[ , <span class="st">"y = 1"</span>, <span class="st">"z = 1"</span>])</span>
<span id="cb45-116"><a href="#cb45-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-117"><a href="#cb45-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-118"><a href="#cb45-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-119"><a href="#cb45-119" aria-hidden="true" tabindex="-1"></a>Now apply confirmed results from above to a real scenario.</span>
<span id="cb45-120"><a href="#cb45-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-123"><a href="#cb45-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-124"><a href="#cb45-124" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-simulation</span></span>
<span id="cb45-125"><a href="#cb45-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-126"><a href="#cb45-126" aria-hidden="true" tabindex="-1"></a><span class="co"># initial vectors</span></span>
<span id="cb45-127"><a href="#cb45-127" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; i = obs ID, mu = mean and sigma = sd</span></span>
<span id="cb45-128"><a href="#cb45-128" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="co"># not using n = 10 so that can set row names below</span></span>
<span id="cb45-129"><a href="#cb45-129" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">500</span>)</span>
<span id="cb45-130"><a href="#cb45-130" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">5</span>)</span>
<span id="cb45-131"><a href="#cb45-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-132"><a href="#cb45-132" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize an empty array (dim = i by mu by sigma) and change dimension labels</span></span>
<span id="cb45-133"><a href="#cb45-133" aria-hidden="true" tabindex="-1"></a>data_sim <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(i) <span class="sc">*</span> <span class="fu">length</span>(mu) <span class="sc">*</span> <span class="fu">length</span>(sigma)),</span>
<span id="cb45-134"><a href="#cb45-134" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(i), <span class="fu">length</span>(mu), <span class="fu">length</span>(sigma)))</span>
<span id="cb45-135"><a href="#cb45-135" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(data_sim) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">paste0</span>(<span class="st">"i"</span>, i), <span class="fu">paste0</span>(<span class="st">"mu = "</span>, mu), <span class="fu">paste0</span>(<span class="st">"sigma = "</span>, sigma))</span>
<span id="cb45-136"><a href="#cb45-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-137"><a href="#cb45-137" aria-hidden="true" tabindex="-1"></a><span class="co"># to generate the data in the best way, need to be saving just the results from the iterations i, and double for loop to access the different columns (mean) and layers (sd) like in the notes for beyond dataframe</span></span>
<span id="cb45-138"><a href="#cb45-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-139"><a href="#cb45-139" aria-hidden="true" tabindex="-1"></a><span class="co"># vectorize over the means to create a matrix of obs from each mean</span></span>
<span id="cb45-140"><a href="#cb45-140" aria-hidden="true" tabindex="-1"></a><span class="co"># then use a for loop to loop over the different standard deviation (as the third dimension)</span></span>
<span id="cb45-141"><a href="#cb45-141" aria-hidden="true" tabindex="-1"></a><span class="co"># (use the holding structure 'data' that is create at beginning of this section)</span></span>
<span id="cb45-142"><a href="#cb45-142" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sigma)) {</span>
<span id="cb45-143"><a href="#cb45-143" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mu)) {</span>
<span id="cb45-144"><a href="#cb45-144" aria-hidden="true" tabindex="-1"></a>    data_sim[ , j, k] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">length</span>(i), <span class="at">mean =</span> mu[j], <span class="at">sd =</span> sigma[k])</span>
<span id="cb45-145"><a href="#cb45-145" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-146"><a href="#cb45-146" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-147"><a href="#cb45-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-148"><a href="#cb45-148" aria-hidden="true" tabindex="-1"></a><span class="co"># now confirm that the summaries match the parameters</span></span>
<span id="cb45-149"><a href="#cb45-149" aria-hidden="true" tabindex="-1"></a>data_means <span class="ot">&lt;-</span> <span class="fu">apply</span>(data_sim, <span class="at">MARGIN =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), mean)</span>
<span id="cb45-150"><a href="#cb45-150" aria-hidden="true" tabindex="-1"></a>data_sd <span class="ot">&lt;-</span> <span class="fu">apply</span>(data_sim, <span class="at">MARGIN =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), sd)</span>
<span id="cb45-151"><a href="#cb45-151" aria-hidden="true" tabindex="-1"></a>data_means</span>
<span id="cb45-152"><a href="#cb45-152" aria-hidden="true" tabindex="-1"></a>data_sd</span>
<span id="cb45-153"><a href="#cb45-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-154"><a href="#cb45-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-155"><a href="#cb45-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-156"><a href="#cb45-156" aria-hidden="true" tabindex="-1"></a><span class="fu">## Solution </span></span>
<span id="cb45-157"><a href="#cb45-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-158"><a href="#cb45-158" aria-hidden="true" tabindex="-1"></a><span class="fu">### Gather simulated gamma data</span></span>
<span id="cb45-159"><a href="#cb45-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-162"><a href="#cb45-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-163"><a href="#cb45-163" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: function</span></span>
<span id="cb45-164"><a href="#cb45-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-165"><a href="#cb45-165" aria-hidden="true" tabindex="-1"></a><span class="co"># define function to create an array [sample size (n) x # of shapes (M) x # of scales (L)] of simulated data from a gamma distribution</span></span>
<span id="cb45-166"><a href="#cb45-166" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; arguments: n = sample size (integer), M = shape parameters (numeric vector), scale parameters (numeric vector), seed to set (integer)</span></span>
<span id="cb45-167"><a href="#cb45-167" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; returns: n x M x L array</span></span>
<span id="cb45-168"><a href="#cb45-168" aria-hidden="true" tabindex="-1"></a>sim_gam <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">sample_size =</span> <span class="dv">10</span>, <span class="at">shapes =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="dv">1</span>, <span class="at">seed =</span> <span class="cn">NULL</span>) {</span>
<span id="cb45-169"><a href="#cb45-169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-170"><a href="#cb45-170" aria-hidden="true" tabindex="-1"></a>  <span class="co"># conditionally set the random seed</span></span>
<span id="cb45-171"><a href="#cb45-171" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(seed))</span>
<span id="cb45-172"><a href="#cb45-172" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed)</span>
<span id="cb45-173"><a href="#cb45-173" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-174"><a href="#cb45-174" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize an empty array (dim = n by shape by scale) and change main dimension labels</span></span>
<span id="cb45-175"><a href="#cb45-175" aria-hidden="true" tabindex="-1"></a>  data_sim <span class="ot">=</span> <span class="fu">array</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, sample_size <span class="sc">*</span> <span class="fu">length</span>(shapes) <span class="sc">*</span> <span class="fu">length</span>(shapes)),</span>
<span id="cb45-176"><a href="#cb45-176" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dim =</span> <span class="fu">c</span>(sample_size, <span class="fu">length</span>(shapes), <span class="fu">length</span>(shapes)))</span>
<span id="cb45-177"><a href="#cb45-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(data_sim) <span class="ot">=</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">paste0</span>(<span class="st">"shape = "</span>, shapes), <span class="fu">paste0</span>(<span class="st">"scale = "</span>, scales))</span>
<span id="cb45-178"><a href="#cb45-178" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-179"><a href="#cb45-179" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate data from the specified shape and scale combination using nested for loops</span></span>
<span id="cb45-180"><a href="#cb45-180" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">NOTE</span><span class="co">: there are different ways to do this with either two sapply() statements or a for loop with a sapply</span></span>
<span id="cb45-181"><a href="#cb45-181" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -&gt; but this is makes the most logical sense: fill each layer column by column rather than fill one layer "in bulk"</span></span>
<span id="cb45-182"><a href="#cb45-182" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(scales)) {</span>
<span id="cb45-183"><a href="#cb45-183" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(shapes)) {</span>
<span id="cb45-184"><a href="#cb45-184" aria-hidden="true" tabindex="-1"></a>      data_sim[ , j, k] <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="at">n =</span> sample_size, <span class="at">shape =</span> shapes[j], <span class="at">scale =</span> scales[k])</span>
<span id="cb45-185"><a href="#cb45-185" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-186"><a href="#cb45-186" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-187"><a href="#cb45-187" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-188"><a href="#cb45-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data_sim)</span>
<span id="cb45-189"><a href="#cb45-189" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-190"><a href="#cb45-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-191"><a href="#cb45-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-192"><a href="#cb45-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-193"><a href="#cb45-193" aria-hidden="true" tabindex="-1"></a>The body from the above implementation is where we generate the data is equivalent to the following if we wanted to use an APPLY statement.</span>
<span id="cb45-194"><a href="#cb45-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-197"><a href="#cb45-197" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-198"><a href="#cb45-198" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: function2</span></span>
<span id="cb45-199"><a href="#cb45-199" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb45-200"><a href="#cb45-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-201"><a href="#cb45-201" aria-hidden="true" tabindex="-1"></a>  <span class="co"># equivalent to:</span></span>
<span id="cb45-202"><a href="#cb45-202" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use an inner sapply() to fill the entire layer with one function call (sapply() then does it shape by shape column at a time) rather than column by column loop for changing layer</span></span>
<span id="cb45-203"><a href="#cb45-203" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(scales)) {</span>
<span id="cb45-204"><a href="#cb45-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-205"><a href="#cb45-205" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate the random numbers according to the scales (changes by matrix) and the shapes (changes by column within matrix)</span></span>
<span id="cb45-206"><a href="#cb45-206" aria-hidden="true" tabindex="-1"></a>    data_sim[ , , i] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="at">X =</span> shapes, <span class="cf">function</span>(X) <span class="fu">rgamma</span>(<span class="at">n =</span> sample_size, <span class="at">shape =</span> X, <span class="at">scale =</span> scales[i]))</span>
<span id="cb45-207"><a href="#cb45-207" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-208"><a href="#cb45-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-209"><a href="#cb45-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-210"><a href="#cb45-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-211"><a href="#cb45-211" aria-hidden="true" tabindex="-1"></a>Now with the function defined, we can generate the data.</span>
<span id="cb45-212"><a href="#cb45-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-215"><a href="#cb45-215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-216"><a href="#cb45-216" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: generate-data</span></span>
<span id="cb45-217"><a href="#cb45-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-218"><a href="#cb45-218" aria-hidden="true" tabindex="-1"></a><span class="co"># initial vectors of the changing parameters for generating data</span></span>
<span id="cb45-219"><a href="#cb45-219" aria-hidden="true" tabindex="-1"></a>sample_sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">1000</span>)</span>
<span id="cb45-220"><a href="#cb45-220" aria-hidden="true" tabindex="-1"></a>shape_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb45-221"><a href="#cb45-221" aria-hidden="true" tabindex="-1"></a>scale_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb45-222"><a href="#cb45-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-223"><a href="#cb45-223" aria-hidden="true" tabindex="-1"></a><span class="co"># generate data</span></span>
<span id="cb45-224"><a href="#cb45-224" aria-hidden="true" tabindex="-1"></a><span class="co"># add dimension labels for the sample sizes</span></span>
<span id="cb45-225"><a href="#cb45-225" aria-hidden="true" tabindex="-1"></a>gam_arrays_list <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="at">X =</span> sample_sizes, <span class="cf">function</span>(X) <span class="fu">sim_gam</span>(<span class="at">sample_size =</span> X, <span class="at">shapes =</span> shape_vec, <span class="at">scales =</span> scale_vec))</span>
<span id="cb45-226"><a href="#cb45-226" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gam_arrays_list) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"n = "</span>, sample_sizes)</span>
<span id="cb45-227"><a href="#cb45-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-228"><a href="#cb45-228" aria-hidden="true" tabindex="-1"></a><span class="co"># view results</span></span>
<span id="cb45-229"><a href="#cb45-229" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gam_arrays_list)</span>
<span id="cb45-230"><a href="#cb45-230" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(gam_arrays_list<span class="sc">$</span><span class="st">`</span><span class="at">n = 25</span><span class="st">`</span>[, , <span class="dv">1</span>], <span class="dv">3</span>)</span>
<span id="cb45-231"><a href="#cb45-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-232"><a href="#cb45-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-233"><a href="#cb45-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-234"><a href="#cb45-234" aria-hidden="true" tabindex="-1"></a><span class="fu">### Compute means and confidence intervals </span></span>
<span id="cb45-235"><a href="#cb45-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-238"><a href="#cb45-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-239"><a href="#cb45-239" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: summarize-data</span></span>
<span id="cb45-240"><a href="#cb45-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-241"><a href="#cb45-241" aria-hidden="true" tabindex="-1"></a><span class="co"># define function to calculate the mean of the simulated observations for each combination of shape and scale</span></span>
<span id="cb45-242"><a href="#cb45-242" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; argument: n x M x L array of simulated values</span></span>
<span id="cb45-243"><a href="#cb45-243" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; returns: M x L matrix of column means from each layer</span></span>
<span id="cb45-244"><a href="#cb45-244" aria-hidden="true" tabindex="-1"></a>gam_means <span class="ot">&lt;-</span> <span class="cf">function</span>(gam_array){</span>
<span id="cb45-245"><a href="#cb45-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(gam_array, <span class="at">MARGIN =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), mean)</span>
<span id="cb45-246"><a href="#cb45-246" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-247"><a href="#cb45-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-248"><a href="#cb45-248" aria-hidden="true" tabindex="-1"></a><span class="co"># function to get CIs for each combination of shape and scale parameters</span></span>
<span id="cb45-249"><a href="#cb45-249" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; argument: n x M x L array of simulated values</span></span>
<span id="cb45-250"><a href="#cb45-250" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; returns: 2 x M x L array of confidence interval bounds for each column of each layer</span></span>
<span id="cb45-251"><a href="#cb45-251" aria-hidden="true" tabindex="-1"></a>gam_CIs <span class="ot">&lt;-</span> <span class="cf">function</span>(gam_array){</span>
<span id="cb45-252"><a href="#cb45-252" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-253"><a href="#cb45-253" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run a t-test for each combination of shape and scale values</span></span>
<span id="cb45-254"><a href="#cb45-254" aria-hidden="true" tabindex="-1"></a>  t_tests <span class="ot">=</span> <span class="fu">apply</span>(<span class="at">X =</span> gam_array, <span class="at">MARGIN =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="at">FUN =</span> t.test)</span>
<span id="cb45-255"><a href="#cb45-255" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-256"><a href="#cb45-256" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract the CI bounds for the mean of the samples</span></span>
<span id="cb45-257"><a href="#cb45-257" aria-hidden="true" tabindex="-1"></a>  ci_bounds <span class="ot">=</span> <span class="fu">apply</span>(<span class="at">X =</span> t_tests, <span class="at">MARGIN =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="cf">function</span>(t) t[[<span class="dv">1</span>]]<span class="sc">$</span>conf.int)</span>
<span id="cb45-258"><a href="#cb45-258" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-259"><a href="#cb45-259" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add rownames for each matrix to indicate which CI bound it is</span></span>
<span id="cb45-260"><a href="#cb45-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(ci_bounds)[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lower bound"</span>, <span class="st">"upper bound"</span>)</span>
<span id="cb45-261"><a href="#cb45-261" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-262"><a href="#cb45-262" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return array</span></span>
<span id="cb45-263"><a href="#cb45-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ci_bounds)</span>
<span id="cb45-264"><a href="#cb45-264" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-265"><a href="#cb45-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-266"><a href="#cb45-266" aria-hidden="true" tabindex="-1"></a><span class="co"># (multiple ways to) create a list of arrays containing the means for each sample of the generated data</span></span>
<span id="cb45-267"><a href="#cb45-267" aria-hidden="true" tabindex="-1"></a><span class="co"># use lapply to keep as list and not simplify to matrix</span></span>
<span id="cb45-268"><a href="#cb45-268" aria-hidden="true" tabindex="-1"></a>gam_x_bars <span class="ot">&lt;-</span> <span class="fu">lapply</span>(gam_arrays_list, gam_means) <span class="co"># equivalent to: lapply(X = gam_arrays_list, FUN = function(X) gam_means(X))</span></span>
<span id="cb45-269"><a href="#cb45-269" aria-hidden="true" tabindex="-1"></a>gam_x_bars <span class="ot">&lt;-</span> <span class="fu">map</span>(gam_arrays_list, \(array) <span class="fu">gam_means</span>(array)) <span class="co"># more readable</span></span>
<span id="cb45-270"><a href="#cb45-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-271"><a href="#cb45-271" aria-hidden="true" tabindex="-1"></a><span class="co"># create a list of arrays containing the confidence interval bounds for the mean of each sample of the generated data</span></span>
<span id="cb45-272"><a href="#cb45-272" aria-hidden="true" tabindex="-1"></a>gam_ci_bounds <span class="ot">&lt;-</span> <span class="fu">map</span>(gam_arrays_list, \(array) <span class="fu">gam_CIs</span>(array))</span>
<span id="cb45-273"><a href="#cb45-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-274"><a href="#cb45-274" aria-hidden="true" tabindex="-1"></a><span class="co"># view results</span></span>
<span id="cb45-275"><a href="#cb45-275" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gam_x_bars)</span>
<span id="cb45-276"><a href="#cb45-276" aria-hidden="true" tabindex="-1"></a>gam_x_bars<span class="sc">$</span><span class="st">`</span><span class="at">n = 25</span><span class="st">`</span></span>
<span id="cb45-277"><a href="#cb45-277" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gam_ci_bounds)</span>
<span id="cb45-278"><a href="#cb45-278" aria-hidden="true" tabindex="-1"></a>gam_ci_bounds<span class="sc">$</span><span class="st">`</span><span class="at">n = 25</span><span class="st">`</span></span>
<span id="cb45-279"><a href="#cb45-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-280"><a href="#cb45-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>