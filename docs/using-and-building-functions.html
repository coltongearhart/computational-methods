<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.376">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Computational Methods in R - 2&nbsp; Using and Building Functions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./permutation-tests.html" rel="next">
<link href="./beyond-dataframes.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./course-notes.html">Course Notes</a></li><li class="breadcrumb-item"><a href="./using-and-building-functions.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Using and Building Functions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./course-notes.html">Course Notes</a></li><li class="breadcrumb-item"><a href="./using-and-building-functions.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Using and Building Functions</span></a></li></ol></nav><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title"><span id="sec-using-and-building-functions" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Using and Building Functions</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Computational Methods in R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./course-notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./beyond-dataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Beyond Dataframes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./using-and-building-functions.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Using and Building Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./permutation-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Permutation Tests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bootstrap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bootstrap</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./computational-experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Computational Experiments</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./assignments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hw1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Homework 1</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">2.1</span> Overview</a></li>
  <li>
<a href="#r-function-basics---components" id="toc-r-function-basics---components" class="nav-link" data-scroll-target="#r-function-basics---components"><span class="header-section-number">2.2</span> R Function Basics - Components</a>
  <ul class="collapse">
<li><a href="#formals" id="toc-formals" class="nav-link" data-scroll-target="#formals"><span class="header-section-number">2.2.1</span> Formals</a></li>
  <li><a href="#body" id="toc-body" class="nav-link" data-scroll-target="#body"><span class="header-section-number">2.2.2</span> Body</a></li>
  <li><a href="#environment" id="toc-environment" class="nav-link" data-scroll-target="#environment"><span class="header-section-number">2.2.3</span> Environment</a></li>
  </ul>
</li>
  <li>
<a href="#creating-functions" id="toc-creating-functions" class="nav-link" data-scroll-target="#creating-functions"><span class="header-section-number">2.3</span> Creating Functions</a>
  <ul class="collapse">
<li><a href="#calling-a-function" id="toc-calling-a-function" class="nav-link" data-scroll-target="#calling-a-function"><span class="header-section-number">2.3.1</span> Calling a Function</a></li>
  <li><a href="#automating-procedures" id="toc-automating-procedures" class="nav-link" data-scroll-target="#automating-procedures"><span class="header-section-number">2.3.2</span> Automating procedures</a></li>
  </ul>
</li>
  <li>
<a href="#applying-functions-over-multiple-sets-of-parameters" id="toc-applying-functions-over-multiple-sets-of-parameters" class="nav-link" data-scroll-target="#applying-functions-over-multiple-sets-of-parameters"><span class="header-section-number">2.4</span> Applying functions over multiple sets of parameters</a>
  <ul class="collapse">
<li><a href="#simulate-data" id="toc-simulate-data" class="nav-link" data-scroll-target="#simulate-data"><span class="header-section-number">2.4.1</span> Simulate data</a></li>
  <li><a href="#summarize-simulation" id="toc-summarize-simulation" class="nav-link" data-scroll-target="#summarize-simulation"><span class="header-section-number">2.4.2</span> Summarize simulation</a></li>
  <li><a href="#entire-workflow" id="toc-entire-workflow" class="nav-link" data-scroll-target="#entire-workflow"><span class="header-section-number">2.4.3</span> Entire workflow</a></li>
  </ul>
</li>
  <li><a href="#writing-modular-functions" id="toc-writing-modular-functions" class="nav-link" data-scroll-target="#writing-modular-functions"><span class="header-section-number">2.5</span> Writing Modular Functions</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><section id="overview" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="overview">
<span class="header-section-number">2.1</span> Overview</h2>
<p>This section will discuss R functions. Functions are the engines that define how to DO things with your data objects in R. If data objects are the “nouns”, then functions are the “verbs” of the R language.</p>
<p>Why build functions?</p>
<ol type="1">
<li><p>Because it is fun (for us nerdy people).</p></li>
<li><p>Because we find ourselves doing the same task multiple times throughout our code, and realize that each iteration is mostly the same process using slightly different values or variables.</p></li>
<li><p>Because we want to avoid copy/paste related errors.</p></li>
<li><p>Because we want to make our code more readable.</p></li>
</ol>
<p>This will discuss the basic structure and components of a function, how a function is created, passing parameters implicitly versus explicitly in a function call, name masking in nested environments, and infix operators.</p>
<p>Below are links to supplementary resources about building functions in R:</p>
<ul>
<li><a href="http://adv-r.had.co.nz/Functions.html">Advanced R Functions Chapter</a></li>
<li><a href="https://r4ds.hadley.nz/functions">Additional Functions Reading from R for Data Science E-book</a></li>
</ul></section><section id="r-function-basics---components" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="r-function-basics---components">
<span class="header-section-number">2.2</span> R Function Basics - Components</h2>
<blockquote class="blockquote">
<p>``To understand computations in R, two slogans are helpful: Everything that exists is an object. Everything that happens is a function call.’’ — John Chambers</p>
</blockquote>
<p>Formals: The defined parameters of a function. Think of these as the set of data objects and options that can be defined by the programmer when a function is used.</p>
<p>For these exercises we will consider the following functions:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> from base R</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> from the ggplot2 package</li>
<li>
<code>%&gt;%</code> piping symbol from the dplyr package</li>
</ul>
<div class="cell" data-hash="using-and-building-functions_cache/html/function-calls_e7da165f65a7c8d2c9bd2a2c3fb2b4ec">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a function without parentheses prints what it is</span></span>
<span><span class="co"># -&gt; with the parenthesis, it tells R to run it</span></span>
<span><span class="va">mean</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (x, ...) 
UseMethod("mean")
&lt;bytecode: 0x7fda9fd08578&gt;
&lt;environment: namespace:base&gt;</code></pre>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ggplot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (data = NULL, mapping = aes(), ..., environment = parent.frame()) 
{
    UseMethod("ggplot")
}
&lt;bytecode: 0x7fda6da13ac0&gt;
&lt;environment: namespace:ggplot2&gt;</code></pre>
</div>
</div>
<p>Pipe</p>
<ul>
<li><p>This is actually quite a complex function (yes, a function) (things like this are called infix operator). Infix operators go in between arguments.</p></li>
<li><p>Can surround an infix operator with tick marks to see what this function is actually doing.</p></li>
</ul>
<div class="cell" data-hash="using-and-building-functions_cache/html/pipe_422fee37ce226f524428a97bba725900">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># infix operator: pipe</span></span>
<span><span class="va">`%&gt;%`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (lhs, rhs) 
{
    lhs &lt;- substitute(lhs)
    rhs &lt;- substitute(rhs)
    kind &lt;- 1L
    env &lt;- parent.frame()
    lazy &lt;- TRUE
    .External2(magrittr_pipe)
}
&lt;bytecode: 0x7fda8d9cc3e0&gt;
&lt;environment: namespace:magrittr&gt;</code></pre>
</div>
</div>
<ul>
<li>Another example is <code>+</code>. This is a primitive function, which just means that R doesn’t evaluate it. It sends it down and is evaluated in C (because it is more efficient).</li>
</ul>
<div class="cell" data-hash="using-and-building-functions_cache/html/addition_087dc7848cf2177a866289d37edefa7b">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># infix operator as function</span></span>
<span><span class="fu">`+`</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
<section id="formals" class="level3" data-number="2.2.1"><h3 data-number="2.2.1" class="anchored" data-anchor-id="formals">
<span class="header-section-number">2.2.1</span> Formals</h3>
<p>What are the formals for these functions?</p>
<ul>
<li>
<code>?formals()</code>: Formals are things that we define to change the behavior of the outcome.</li>
</ul>
<div class="cell" data-hash="using-and-building-functions_cache/html/formals_527dc84a90537b6d3b14982677d98659">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># view formals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/formals.html">formals</a></span><span class="op">(</span><span class="va">`%&gt;%`</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$lhs


$rhs</code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/formals.html">formals</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$x


$...</code></pre>
</div>
</div>
<ul>
<li><p><code>...</code> are a special (very flexible, catch all) type of formal argument that we can put non-necessary arguments.</p></li>
<li><p>For example, with mean <code>mean(x, na.rm = TRUE)</code>, this saves the value <code>TRUE</code> to na.rm argument and saves that value as the function is run.</p></li>
</ul></section><section id="body" class="level3" data-number="2.2.2"><h3 data-number="2.2.2" class="anchored" data-anchor-id="body">
<span class="header-section-number">2.2.2</span> Body</h3>
<p>The lines of code that will be run when the function is called. The body uses the formals and usually returns a result of some kind.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/body_bf27354e8b86ef8bb473791352ee9b05">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># body()</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html">body</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># -&gt; returns null because the function isn't run in R</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html">body</a></span><span class="op">(</span><span class="va">ggplot</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{
    UseMethod("ggplot")
}</code></pre>
</div>
</div>
<ul>
<li>Note that the code in the body is never commented because R strips away the comments when running to make its more compact. When we write functions, we add comments so the humans know what it does, but when it is stored they are removed to take up less space.</li>
</ul></section><section id="environment" class="level3" data-number="2.2.3"><h3 data-number="2.2.3" class="anchored" data-anchor-id="environment">
<span class="header-section-number">2.2.3</span> Environment</h3>
<p>The environment is the group of named objects which functions have access to. In other words, it is where the function will retrieve named objects used to execute the code from the body.</p>
<ul>
<li><p>The global environment is everything that we have loaded in, created ourselves or in base R.</p></li>
<li><p><code><a href="https://rdrr.io/r/base/ls.html">ls()</a></code> tells you what you have created / assigned in the global environment (to get, set, test for and create environments, use <code><a href="https://rdrr.io/r/base/environment.html">environment()</a></code>).</p></li>
</ul>
<div class="cell" data-hash="using-and-building-functions_cache/html/global-environment_d0710f71eadff833ada2486d4afbbe1f">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ?environment()</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "has_annotations"</code></pre>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "has_annotations" "y"              </code></pre>
</div>
</div>
<ul>
<li>When calling functions, they have access to the names of objects in the namespace. It can map the name to where the object is stored. So it retrieves values through the names, so names are very powerful and why we can do computation work that is readable.</li>
</ul>
<div class="cell" data-hash="using-and-building-functions_cache/html/namespaces_8606eb5b4b2715d1121839eb60c5b6a4">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># y is now in the namespace, so we have access to it</span></span>
<span><span class="co"># -&gt; the name gets mapped to its value</span></span>
<span><span class="va">y</span><span class="op">*</span><span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2  4  6  8 10</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1          5.1         3.5          1.4         0.2  setosa
2          4.9         3.0          1.4         0.2  setosa
3          4.7         3.2          1.3         0.2  setosa
4          4.6         3.1          1.5         0.2  setosa
5          5.0         3.6          1.4         0.2  setosa
6          5.4         3.9          1.7         0.4  setosa</code></pre>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># -&gt; we were able to find this because head and iris are a namespace in the global environment</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>When we load a library, we are loading a namespace that has access to all the function names and dataset names in the library (package). Everything is a named object (objects, functions, etc.) and they are saved somewhere. The environment is where R finds the object.</li>
</ul>
<p>Local namespaces</p>
<ul>
<li><p>When a function is called, a local namespace is created within the global environment (like a subspace of the global environment).</p></li>
<li><p>When code is run in this local environment, R has access to all objects contained in the global environment.</p></li>
<li><p>The primary difference is that when the local namespace is created, the formal argument names and their defined values are written into the local namespace. If these objects already exist in the global environment, they are overwritten locally while the function code is running. This is referred to as <strong>name masking</strong>.</p></li>
<li><p>After the function code has completed running, the local environment is deleted. Thus, the local environment of a function is both nested in the global environment and is temporary.</p></li>
</ul>
<div class="cell" data-hash="using-and-building-functions_cache/html/local-arguments_44f146609d299ecf9138f77c01c44545">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># when we call the mean function, x is defined locally but not globally</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
</section></section><section id="creating-functions" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="creating-functions">
<span class="header-section-number">2.3</span> Creating Functions</h2>
<p>To create a function you must define the formals and body in using the <code>function()</code> function, and assign the definition to a name.</p>
<ul>
<li><p>Below we are giving a function as a value to the function name.</p></li>
<li><p>Functions are first class objects (they store expressions, rather than data values).</p></li>
<li><p>If there is a set of things we want to do, we can wrap a bunch of code into an expression by wrapping in curly brackets, then R thinks about it as one thing.</p></li>
</ul>
<div class="cell" data-hash="using-and-building-functions_cache/html/defining-functions_cc40d6b8a686e065e5652fae3feb5786">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># writing functions</span></span>
<span><span class="va">function_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">formal_arguments_go_here</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># code body expression goes here</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/formals.html">formals</a></span><span class="op">(</span><span class="va">function_name</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$formal_arguments_go_here</code></pre>
</div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/body.html">body</a></span><span class="op">(</span><span class="va">function_name</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code><a href="https://rdrr.io/r/base/Paren.html">{
}</a></code></pre>
</div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="va">function_name</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;environment: R_GlobalEnv&gt;</code></pre>
</div>
</div>
<p>Also note, <code>function()</code> is a very weird function, since the body argument goes outside the parentheses! Technically even the example above is a real function (albeit a boring one).</p>
<p>Better example of simple function for adding up two numbers.</p>
<ul>
<li><p>Give functions a name that indicate what it does (intuitive names help a great deal with readable code).</p></li>
<li>
<p>Style guide: Can use the assignment arrow <code>&lt;-</code> for anytime something will be saved to the global environment (data values and functions), but within a function we can use <code>=</code> because it is only found locally and is temporary.</p>
<ul>
<li>
<code>&lt;&lt;-</code> Assigns values from a local environment (like a function call) and saves it in the global environment (this is a really bad idea because it could overwrite something that you already have in the global environment)</li>
</ul>
</li>
<li>
<p>Returning values: Functions implicitly return the last thing computed. So it is often a good idea to be explicit about what to return.</p>
<ul>
<li>All standalone functions should have explicit returns. When doing an on-the-fly function in an <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> for example, we can stylistically omit <code><a href="https://rdrr.io/r/base/function.html">return()</a></code> and still have readable code.</li>
</ul>
</li>
</ul>
<div class="cell" data-hash="using-and-building-functions_cache/html/defining-functions-assignment_f9ab824909487ebef8e130fbe28d6fcc">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># write function add two numbers</span></span>
<span><span class="va">my_sum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">val</span> <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">my_sum</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># bad idea</span></span>
<span><span class="va">my_sum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">val</span> <span class="op">&lt;&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># val isn't in the global environment</span></span>
<span><span class="fu">my_sum</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>More complex functions: In a legitimate function, to have our function behave differently, we can use some if and else statements that are usually triggered by a yes / no or true / false.</p>
<p><code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> is a function that calls other functions in an iterative way (really efficient for loop).</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/unnamed-chunk-12_5f8b1f676dc838f165423d2c5bb7b25c">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># label: defining-functions-ifs</span></span>
<span></span>
<span><span class="co"># now trying to do something cool (and / or breaking it)</span></span>
<span><span class="co"># -&gt; on rare occasions, add some random error to the sum</span></span>
<span><span class="va">my_sum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">mischief</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mischief</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">val</span> <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">val</span> <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.02</span>,<span class="fl">.96</span>,<span class="fl">.02</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># run the function 100 times using specified values for the arguments</span></span>
<span><span class="co"># -&gt; not using the X in our function call</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="va">my_sum</span>, x <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 4 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
 [38] 3 3 2 3 3 3 3 3 3 3 4 3 3 3 3 3 3 3 3 3 3 4 3 3 3 3 3 2 3 3 3 3 3 3 3 3 3
 [75] 3 4 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3</code></pre>
</div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># equivalent to</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">my_sum</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3
[1] 3
[1] 3
[1] 3
[1] 3
[1] 3
[1] 3
[1] 3
[1] 3
[1] 3</code></pre>
</div>
</div>
<p>Can return something more complex than just a data value by returning lists. Functions that output lists are kinda the next step of complex computing ideas.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/unnamed-chunk-13_1ca69c081419ddc821d04c818d5654c1">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># label: defining-functions-return-list</span></span>
<span></span>
<span><span class="co"># modify function to return a list with multiple objects in it</span></span>
<span><span class="va">my_sum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">mischief</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mischief</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">val</span> <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">val</span> <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.02</span>,<span class="fl">.96</span>,<span class="fl">.02</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">val</span>,</span>
<span>              mischief <span class="op">=</span> <span class="va">mischief</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">my_sum</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$value
[1] 3

$mischief
[1] TRUE</code></pre>
</div>
</div>
<section id="calling-a-function" class="level3" data-number="2.3.1"><h3 data-number="2.3.1" class="anchored" data-anchor-id="calling-a-function">
<span class="header-section-number">2.3.1</span> Calling a Function</h3>
<p>To call a function, you simply use its name and define any required formal arguments. Typically this is done within a set of parentheses directly following the function name. Only a few special cases break from that pattern.</p>
<p>What is more important to focus on is <strong>if</strong> and <strong>how</strong> we define the arguments. We may choose to define nothing in the arguments and the function might still work.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/args-null_0e713db6c77882dfac583c943e03528b">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># write function that has no arguments to simply return this hardcoded value</span></span>
<span><span class="va">no_arg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fl">10</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">no_arg</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># -&gt; so it will generate an error if we tried to give it an argument that isn't defined in the function</span></span>
<span><span class="fu">no_arg</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in no_arg(x = 20): unused argument (x = 20)</code></pre>
</div>
</div>
<p>Typically these are made more flexible using dots <code>...</code>. All this does is put the values into the local namespace and continues running the function. These are optional arguments.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/args-dots_311f926bb88067a96440c446ab0db58a">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># define function wtih ... formal</span></span>
<span><span class="va">no_arg2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fl">10</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># functions works with no arguments</span></span>
<span><span class="fu">no_arg2</span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># and now with arguments</span></span>
<span><span class="co"># -&gt; it initializes the value of x, but then  overwrites the value of x internally</span></span>
<span><span class="fu">no_arg2</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
<p>For “optional” arguments (arguments that sometimes matters and sometimes don’t matter), we should define them as formal parameters with some default values. This way we can override them if we wanted to.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/args-defaults_eb59379f399928265f743aea11dc2206">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># add default value to argument</span></span>
<span><span class="co"># -&gt; now it behaves typically how we want, but can change them if we want</span></span>
<span><span class="va">no_arg3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># this is the behavior we typically will want</span></span>
<span><span class="fu">no_arg3</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">no_arg3</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
</div>
<p>The more important characteristics of function calls are related to how we define our arguments: implicitly and explicitly. If we rely on the default ordering of the arguements, then we are calling the arguments <em>implicitly</em>. If we refer to the argument by it’s name while defining the values, then we are calling the argument <em>explicitly</em>. Often we use a mix of these methods, but it is important to be aware of how and why we choose to define our arguments.</p>
<p>A function runs through all of the named arguments, then goes in order for the unnamed arguments.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/arg_exp_implicit_f14943d27732a432bba4f216f99b883c">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># all of the following are equivalent</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span>na.rm <span class="op">=</span> <span class="cn">TRUE</span>, x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># the following is NOT equivalent</span></span>
<span><span class="co"># -&gt; it is expecting a numeric first</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in mean.default(TRUE, 1:5): 'trim' must be numeric of length one</code></pre>
</div>
</div>
<p>Possible convention: Implicitly give the function data values first, then use explicit calling for the options (this will still be readable because the function name will indicate what it’s going to do with the data values).</p>
</section><section id="automating-procedures" class="level3" data-number="2.3.2"><h3 data-number="2.3.2" class="anchored" data-anchor-id="automating-procedures">
<span class="header-section-number">2.3.2</span> Automating procedures</h3>
<p>The following example demonstrates code that would be better served by constructing a function to accomplish the task.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/example-change-to-functions-manual_d223c0a9efa57ecf9975a8afaf25096e">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># take the following olive oil data and standardize the columns</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">pdfCluster</span><span class="op">)</span> <span class="co"># for the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">)</span> <span class="co"># ?oliveoil</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  macro.area       region palmitic palmitoleic stearic oleic linoleic linolenic
1      South Apulia.north     1075          75     226  7823      672        36
2      South Apulia.north     1088          73     224  7709      781        31
3      South Apulia.north      911          54     246  8113      549        31
4      South Apulia.north      966          57     240  7952      619        50
5      South Apulia.north     1051          67     259  7771      672        50
6      South Apulia.north      911          49     268  7924      678        51
  arachidic eicosenoic
1        60         29
2        61         29
3        63         29
4        78         35
5        80         46
6        70         44</code></pre>
</div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># start with a dataframe where create the z-scores for palmitic acid, then add the rest </span></span>
<span><span class="va">oo_standardized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  palmitic <span class="op">=</span> <span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"palmitic"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"palmitic"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"palmitic"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">oo_standardized</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    palmitic
1 -0.9297061
2 -0.8525970
3 -1.9024672
4 -1.5762364
5 -1.0720614
6 -1.9024672</code></pre>
</div>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># if wanted to do this manually for all columns we would do this</span></span>
<span><span class="va">oo_standardized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  palmitic <span class="op">=</span> <span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"palmitic"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"palmitic"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"palmitic"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  palmitoleic <span class="op">=</span> <span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"palmitoleic"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"palmitoleic"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"palmitoleic"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  stearic <span class="op">=</span> <span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"stearic"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"stearic"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"stearic"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  oleic <span class="op">=</span> <span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"oleic"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"oleic"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"oleic"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  linoleic <span class="op">=</span> <span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"linoleic"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"linoleic"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"linoleic"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  linolenic <span class="op">=</span> <span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"linolenic"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"linolenic"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"linolenic"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  arachidic <span class="op">=</span> <span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"arachidic"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"arachidic"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"arachidic"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  eicosenoic <span class="op">=</span> <span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"eicosenoic"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"eicosenoic"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="st">"eicosenoic"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">oo_standardized</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    palmitic palmitoleic    stearic     oleic   linoleic  linolenic  arachidic
1 -0.9297061  -0.9733313 -0.0779804 1.2598296 -1.2707124  0.3170625 0.08634028
2 -0.8525970  -1.0114306 -0.1324097 0.9789102 -0.8217818 -0.0684812 0.13173241
3 -1.9024672  -1.3733742  0.4663123 1.9744494 -1.7773038 -0.0684812 0.22251667
4 -1.5762364  -1.3162252  0.3030245 1.5777122 -1.4889997  1.3965850 0.90339865
5 -1.0720614  -1.1257286  0.8201026 1.1316909 -1.2707124  1.3965850 0.99418291
6 -1.9024672  -1.4686225  1.0650343 1.5087145 -1.2460006  1.4736938 0.54026160
  eicosenoic
1  0.9030934
2  0.9030934
3  0.9030934
4  1.3291301
5  2.1101973
6  1.9681851</code></pre>
</div>
</div>
<p>Could do this (slighlty) better with a function, rather than copy and paste and change column names.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/example-change-to-functions-function_4447795e63587321057d389ae88908c1">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># write function to take a variable name and return the standardized column</span></span>
<span><span class="va">oo_stand</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">varname</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="va">varname</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="va">varname</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="va">varname</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">oo_stand</span><span class="op">(</span><span class="st">"palmitic"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -0.9297061 -0.8525970 -1.9024672 -1.5762364 -1.0720614 -1.9024672
 [7] -1.8372211 -0.7814194 -0.8881858 -1.1551020</code></pre>
</div>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># building the standardized data almost as repetitive as previous approach</span></span>
<span><span class="va">oo_standardized2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  palmitic <span class="op">=</span>  <span class="fu">oo_stand</span><span class="op">(</span><span class="st">"palmitic"</span><span class="op">)</span>,</span>
<span>  palmitoleic <span class="op">=</span>  <span class="fu">oo_stand</span><span class="op">(</span><span class="st">"palmitoleic"</span><span class="op">)</span>,</span>
<span>  stearic <span class="op">=</span>  <span class="fu">oo_stand</span><span class="op">(</span><span class="st">"stearic"</span><span class="op">)</span>,</span>
<span>  oleic <span class="op">=</span>  <span class="fu">oo_stand</span><span class="op">(</span><span class="st">"oleic"</span><span class="op">)</span>,</span>
<span>  linoleic <span class="op">=</span>  <span class="fu">oo_stand</span><span class="op">(</span><span class="st">"linoleic"</span><span class="op">)</span>,</span>
<span>  linolenic <span class="op">=</span>  <span class="fu">oo_stand</span><span class="op">(</span><span class="st">"linolenic"</span><span class="op">)</span>,</span>
<span>  arachidic <span class="op">=</span>  <span class="fu">oo_stand</span><span class="op">(</span><span class="st">"arachidic"</span><span class="op">)</span>,</span>
<span>  eicosenoic <span class="op">=</span>  <span class="fu">oo_stand</span><span class="op">(</span><span class="st">"eicosenoic"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">oo_standardized2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    palmitic palmitoleic    stearic     oleic   linoleic  linolenic  arachidic
1 -0.9297061  -0.9733313 -0.0779804 1.2598296 -1.2707124  0.3170625 0.08634028
2 -0.8525970  -1.0114306 -0.1324097 0.9789102 -0.8217818 -0.0684812 0.13173241
3 -1.9024672  -1.3733742  0.4663123 1.9744494 -1.7773038 -0.0684812 0.22251667
4 -1.5762364  -1.3162252  0.3030245 1.5777122 -1.4889997  1.3965850 0.90339865
5 -1.0720614  -1.1257286  0.8201026 1.1316909 -1.2707124  1.3965850 0.99418291
6 -1.9024672  -1.4686225  1.0650343 1.5087145 -1.2460006  1.4736938 0.54026160
  eicosenoic
1  0.9030934
2  0.9030934
3  0.9030934
4  1.3291301
5  2.1101973
6  1.9681851</code></pre>
</div>
</div>
<p>Next, can do this iteratively with for-loops to first print the result (for demonstration) and then to store the result.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/example-change-to-functions-for-loops_2297169af99b9f6bc344e789af012811">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># intitialize names</span></span>
<span><span class="va">acids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop over names and print first few standardized observations</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">acid_name</span> <span class="kw">in</span> <span class="va">acids</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">oo_stand</span><span class="op">(</span><span class="va">acid_name</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.9297061 -0.8525970 -1.9024672 -1.5762364 -1.0720614
[1] -0.9733313 -1.0114306 -1.3733742 -1.3162252 -1.1257286
[1] -0.0779804 -0.1324097  0.4663123  0.3030245  0.8201026
[1] 1.2598296 0.9789102 1.9744494 1.5777122 1.1316909
[1] -1.2707124 -0.8217818 -1.7773038 -1.4889997 -1.2707124
[1]  0.3170625 -0.0684812 -0.0684812  1.3965850  1.3965850
[1] 0.08634028 0.13173241 0.22251667 0.90339865 0.99418291
[1] 0.9030934 0.9030934 0.9030934 1.3291301 2.1101973</code></pre>
</div>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># initialization storage space for transformed values</span></span>
<span><span class="va">oo_standardized3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">)</span> <span class="op">*</span> <span class="fl">8</span><span class="op">)</span>, </span>
<span>                           nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">as.data.frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">oo_standardized3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># loop over the acid names</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">acid_name</span> <span class="kw">in</span> <span class="va">acids</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">oo_standardized3</span><span class="op">[</span>,<span class="va">acid_name</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">oo_stand</span><span class="op">(</span><span class="va">acid_name</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># check the outcome</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">oo_standardized3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    palmitic palmitoleic    stearic     oleic   linoleic  linolenic  arachidic
1 -0.9297061  -0.9733313 -0.0779804 1.2598296 -1.2707124  0.3170625 0.08634028
2 -0.8525970  -1.0114306 -0.1324097 0.9789102 -0.8217818 -0.0684812 0.13173241
3 -1.9024672  -1.3733742  0.4663123 1.9744494 -1.7773038 -0.0684812 0.22251667
4 -1.5762364  -1.3162252  0.3030245 1.5777122 -1.4889997  1.3965850 0.90339865
5 -1.0720614  -1.1257286  0.8201026 1.1316909 -1.2707124  1.3965850 0.99418291
6 -1.9024672  -1.4686225  1.0650343 1.5087145 -1.2460006  1.4736938 0.54026160
  eicosenoic
1  0.9030934
2  0.9030934
3  0.9030934
4  1.3291301
5  2.1101973
6  1.9681851</code></pre>
</div>
</div>
<p>Best solution is to vectorize the procedure and use the APPLY type statements.</p>
<ul>
<li><p><code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> used to apply functions over the indices of an array.</p></li>
<li><p><code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> used to apply functions over the values in a list, outputs to a list.</p></li>
<li>
<p><code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> used to apply functions over the values in a list, outputs to a simplified array.</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> and <code>sapply(simplify = FALSE)</code> are the same thing, kinda how <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> and <code><a href="https://rdrr.io/r/base/paste.html">paste0()</a></code> are the same except <code><a href="https://rdrr.io/r/base/paste.html">paste0()</a></code> has a default separator (which is very useful, so they just gave it a shorthand function).</li>
</ul>
</li>
<li><p><code><a href="https://rdrr.io/r/base/lapply.html">vapply()</a></code> used to apply functions over the values in a list, outputs to specified object type.</p></li>
<li><p><code><a href="https://rdrr.io/r/base/mapply.html">mapply()</a></code> used to apply functions over the corresponding values in multiple lists.</p></li>
</ul>
<p>Karsten’s Personal Use (with orders of magnitude &gt;): <code>sapply</code> <span class="math inline">\(&gt;\)</span> <code>lapply</code> <span class="math inline">\(&gt;&gt;\)</span> <code>mapply</code> <span class="math inline">\(&gt;&gt;\)</span> <code>vapply</code> <span class="math inline">\(&gt;&gt;\)</span> <code>apply</code></p>
<div class="cell" data-hash="using-and-building-functions_cache/html/example-change-to-functions-apply_fa4bce8a02c55276228f197199b95754">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># loop over all column names with sapply()</span></span>
<span><span class="co"># -&gt; typically in practice the formals are given implicitly and just know that the object to be looped over is first and the function being applied is second</span></span>
<span><span class="va">oo_better</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">acids</span>, FUN <span class="op">=</span> <span class="va">oo_stand</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">as.data.frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">better_oo</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'better_oo' not found</code></pre>
</div>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># same thing, but return object is a list</span></span>
<span><span class="va">oo_better_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">acids</span>, FUN <span class="op">=</span> <span class="va">oo_stand</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">oo_better_list</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 8
 $ : num [1:572] -0.93 -0.853 -1.902 -1.576 -1.072 ...
 $ : num [1:572] -0.973 -1.011 -1.373 -1.316 -1.126 ...
 $ : num [1:572] -0.078 -0.132 0.466 0.303 0.82 ...
 $ : num [1:572] 1.26 0.979 1.974 1.578 1.132 ...
 $ : num [1:572] -1.271 -0.822 -1.777 -1.489 -1.271 ...
 $ : num [1:572] 0.3171 -0.0685 -0.0685 1.3966 1.3966 ...
 $ : num [1:572] 0.0863 0.1317 0.2225 0.9034 0.9942 ...
 $ : num [1:572] 0.903 0.903 0.903 1.329 2.11 ...</code></pre>
</div>
</div>
<p>Can use tidyverse equivalents from the <code>purrr</code> package (<a href="http://purrr.tidyverse.org">documentation</a>), specifically <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>.</p>
<ul>
<li><p><code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> always returns a list, so this would be equivalent <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>.</p></li>
<li>
<p>Other variants include:</p>
<ul>
<li><p><code><a href="https://purrr.tidyverse.org/reference/map.html">map_vec()</a></code> must return a single value from each operation. If you know the output type, it is more efficient to use the corresponding variant such as <code><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl()</a></code>, <code><a href="https://purrr.tidyverse.org/reference/map.html">map_chr()</a></code>, etc.</p></li>
<li><p>indexed map <code><a href="https://purrr.tidyverse.org/reference/imap.html">imap()</a></code> applies a function to each element of a vector, and its index (which is shorthand for a particular use of <code><a href="https://purrr.tidyverse.org/reference/map2.html">map2()</a></code> which iterates over 2 arguments at a time).</p></li>
<li><p><code><a href="https://purrr.tidyverse.org/reference/lmap.html">lmap()</a></code> applies a function to list-elements of a list, useful for applying functions that take lists as arguments.</p></li>
<li><p><code><a href="https://purrr.tidyverse.org/reference/pmap.html">pmap()</a></code> extends <code><a href="https://purrr.tidyverse.org/reference/map2.html">map2()</a></code> to iterate over multiple arguments simultaneously.</p></li>
</ul>
</li>
</ul>
<div class="cell" data-hash="using-and-building-functions_cache/html/example-change-to-functions-map_244a6c50fe9c70eae9cc158076e7345b">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># loop over all column names with sapply()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op">)</span></span>
<span><span class="co">#  </span></span>
<span><span class="co"># help(package="purrr")</span></span>
<span><span class="co"># ?map</span></span>
<span></span>
<span><span class="co"># apply same function over names of columns using purrr equivalent function to lapply</span></span>
<span><span class="va">oo_purrr_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">acids</span>, .f <span class="op">=</span> <span class="va">oo_stand</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">oo_purrr_list</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 8
 $ : num [1:572] -0.93 -0.853 -1.902 -1.576 -1.072 ...
 $ : num [1:572] -0.973 -1.011 -1.373 -1.316 -1.126 ...
 $ : num [1:572] -0.078 -0.132 0.466 0.303 0.82 ...
 $ : num [1:572] 1.26 0.979 1.974 1.578 1.132 ...
 $ : num [1:572] -1.271 -0.822 -1.777 -1.489 -1.271 ...
 $ : num [1:572] 0.3171 -0.0685 -0.0685 1.3966 1.3966 ...
 $ : num [1:572] 0.0863 0.1317 0.2225 0.9034 0.9942 ...
 $ : num [1:572] 0.903 0.903 0.903 1.329 2.11 ...</code></pre>
</div>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># same thing, but now simplify the result</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_vec</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">acids</span>, .f <span class="op">=</span> <span class="va">oo_stand</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `map_vec()`:
! `out[[1]]` must have size 1, not size 572.</code></pre>
</div>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># modify function to just return the st dev of the standardized columns</span></span>
<span><span class="va">oo_stand_sd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">varname</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="va">varname</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="va">varname</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">oliveoil</span><span class="op">[</span>,<span class="va">varname</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_vec</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">acids</span>, .f <span class="op">=</span> <span class="va">oo_stand_sd</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 1 1 1 1 1</code></pre>
</div>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># know returning a double, so use map_dbl()</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">acids</span>, .f <span class="op">=</span> <span class="va">oo_stand_sd</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 1 1 1 1 1</code></pre>
</div>
</div>
<p>Mini timing study to see which method of looping is most efficient.</p>
<ul>
<li>APPLY statements are quicker than for because they are run in C rather than R.</li>
</ul>
<div class="cell" data-hash="using-and-building-functions_cache/html/timing_7f2461db9d0608edc700eb67e6779b66">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create lots of lm from different random samples and store the slope of a particular variable</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># initialize timing study and use for loop</span></span>
<span><span class="va">timer_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">betas</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">palmitic</span> <span class="op">~</span> <span class="va">.</span> , data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span><span class="va">oliveoil</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"oleic"</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">timer_for</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 1.560709 secs</code></pre>
</div>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># now use sapply()</span></span>
<span><span class="co"># -&gt; again not really using X = 1:n in the function that sapply() calls, it is just for the iterations to do the thing that many times</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">timer_sapply</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">palmitic</span> <span class="op">~</span> <span class="va">.</span> , data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span><span class="va">oliveoil</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"oleic"</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">timer_sapply</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 1.470685 secs</code></pre>
</div>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># now use map()</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">timer_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">palmitic</span> <span class="op">~</span> <span class="va">.</span> , data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span><span class="va">oliveoil</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"oleic"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">timer_map</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 1.468523 secs</code></pre>
</div>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># now use map_dbl()</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">timer_dbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">palmitic</span> <span class="op">~</span> <span class="va">.</span> , data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span><span class="va">oliveoil</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"oleic"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">timer_dbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 1.542204 secs</code></pre>
</div>
</div>
</section></section><section id="applying-functions-over-multiple-sets-of-parameters" class="level2" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="applying-functions-over-multiple-sets-of-parameters">
<span class="header-section-number">2.4</span> Applying functions over multiple sets of parameters</h2>
<section id="simulate-data" class="level3" data-number="2.4.1"><h3 data-number="2.4.1" class="anchored" data-anchor-id="simulate-data">
<span class="header-section-number">2.4.1</span> Simulate data</h3>
<p>In some cases we may wish to apply a complex function by putting in multiple sets of arguments and collecting the results. In the example below we explore a simple case where we want to gather simulated values from a beta distribution with several different shape parameter (<span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>) pairs.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/multiple-param-beta_da6b3c5f1b6c1255f44dccdd80ca187a">
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># let's check what the rbeta() function does first in the help menu</span></span>
<span><span class="co"># ?rbeta</span></span>
<span><span class="co"># simulate n observations from a specific beta distribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="fl">5</span>, shape1 <span class="op">=</span> <span class="fl">1</span>, shape2 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07273764 0.68935571 0.81352161 0.88595919 0.85106169</code></pre>
</div>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># want to apply the rbeta() function over all 100 unique combinations</span></span>
<span><span class="co"># of shape1 = {0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5}</span></span>
<span><span class="co"># and shape2 = {0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5}</span></span>
<span><span class="va">param_combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>shape1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                                  shape2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">param_combinations</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  shape1 shape2
1    0.5    0.5
2    1.0    0.5
3    1.5    0.5
4    2.0    0.5
5    2.5    0.5
6    3.0    0.5</code></pre>
</div>
</div>
<p>Could create two nested for loops to iterate over these pairs and store as it loops, but that is messy. Instead we will iterate over each pair using <code><a href="https://rdrr.io/r/base/mapply.html">mapply()</a></code> and <code><a href="https://purrr.tidyverse.org/reference/map2.html">map2()</a></code>.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/iterate-multiple-args_15ba8219597bcc20b17d2c1836235ad6">
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># run simulation to generate 5 values beta values from each parameter combo</span></span>
<span><span class="co"># use mapply() and simplify the result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span></span>
<span><span class="va">my_beta_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span>FUN <span class="op">=</span> <span class="va">rbeta</span>, </span>
<span>                       shape1 <span class="op">=</span> <span class="va">param_combinations</span><span class="op">$</span><span class="va">shape1</span>,</span>
<span>                       shape2 <span class="op">=</span> <span class="va">param_combinations</span><span class="op">$</span><span class="va">shape2</span>,</span>
<span>                       MoreArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>                       SIMPLIFY <span class="op">=</span> <span class="st">"array"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># map way shown at end</span></span>
<span></span>
<span><span class="co"># rows in parameter storage correspond to the columns in the simulation array</span></span>
<span><span class="va">param_combinations</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   shape1 shape2
1     0.5    0.5
2     1.0    0.5
3     1.5    0.5
4     2.0    0.5
5     2.5    0.5
6     3.0    0.5
7     3.5    0.5
8     4.0    0.5
9     4.5    0.5
10    5.0    0.5</code></pre>
</div>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_beta_sims</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]
[1,] 0.5863837 0.4459386 0.9777934 0.4583129 0.9999148 0.9963217 0.8925415
[2,] 0.8116711 0.5797895 0.5087671 0.9677340 0.9994157 0.9926236 0.9558317
[3,] 0.9987221 0.8680033 0.8865398 0.9668572 0.9606193 0.9901395 0.4404319
[4,] 0.1143234 0.9148146 0.9748052 0.7042567 0.6387993 0.9741483 0.9445973
[5,] 0.7077567 0.1463414 0.2696026 0.9829616 0.8444588 0.9754417 0.9852225
          [,8]      [,9]     [,10]
[1,] 0.9280662 0.9951651 0.9999956
[2,] 0.9995616 0.9927259 0.9960698
[3,] 0.9770016 0.9766352 0.9998980
[4,] 0.9049755 0.9865606 0.9889205
[5,] 0.9990467 0.7723663 0.7884314</code></pre>
</div>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># use map2()</span></span>
<span><span class="co"># -&gt; returns a list, so have to reduce it to turn into a matrix and then set the colnames to be readable</span></span>
<span><span class="va">my_beta_sims</span> <span class="op">&lt;-</span> <span class="va">param_combinations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="op">{</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">shape1</span>, <span class="va">.</span><span class="op">$</span><span class="va">shape2</span>,</span>
<span>       \<span class="op">(</span><span class="va">shape1</span>, <span class="va">shape2</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span>, shape1 <span class="op">=</span> <span class="va">shape1</span>, shape2 <span class="op">=</span> <span class="va">shape2</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">cbind</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">my_beta_sims</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"sim"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">param_combinations</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or even better organization is to turn this into an 3-dimensional array where the index <code>[i,j,k]</code> represent the <span class="math inline">\(i\)</span>th simulation, <span class="math inline">\(j\)</span>th <code>shape1</code>, and <span class="math inline">\(k\)</span>-th <code>shape2</code>.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/array_ec044f2add7e6d13e4bfd14c5308bf88">
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># convert copy of matrix to array (remember )</span></span>
<span><span class="va">my_beta_sims_array</span> <span class="op">&lt;-</span> <span class="va">my_beta_sims</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">my_beta_sims_array</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remember R goes down the columns first to fill the first layer</span></span>
<span><span class="co"># -&gt; then starts the next layer down the columns....</span></span>
<span><span class="va">my_beta_sims_array</span><span class="op">[</span> , , <span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="va">my_beta_sims</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     sim 1 sim 2 sim 3 sim 4 sim 5 sim 6 sim 7 sim 8 sim 9 sim 10
[1,]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE   TRUE
[2,]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE   TRUE
[3,]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE   TRUE
[4,]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE   TRUE
[5,]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE   TRUE</code></pre>
</div>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># display all simulations from the first shape 2 (columns = simulation and rows = iteration)</span></span>
<span><span class="va">my_beta_sims_array</span><span class="op">[</span> , , <span class="fl">1</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]
[1,] 0.006280542 0.7532718 0.4820312 0.9935087 0.8546249 0.9423096 0.6818702
[2,] 0.341378768 0.6908183 0.9369698 0.1185105 0.9269818 0.9353278 0.9671111
[3,] 0.544664311 0.8313604 0.8681536 0.7087383 0.9975304 0.6857775 0.9221920
[4,] 0.888962458 0.5024863 0.6659881 0.9869572 0.9667159 0.6357080 0.8850950
[5,] 0.551292466 0.9969978 0.9872116 0.8641136 0.7538840 0.9777792 0.9969331
          [,8]      [,9]     [,10]
[1,] 0.9598644 0.9993042 0.8993634
[2,] 0.7964658 0.9504420 0.7584427
[3,] 0.8090599 0.9972686 0.9782978
[4,] 0.9996361 0.9822641 0.8401233
[5,] 0.7822795 0.8821006 0.9076706</code></pre>
</div>
</div>
</section><section id="summarize-simulation" class="level3" data-number="2.4.2"><h3 data-number="2.4.2" class="anchored" data-anchor-id="summarize-simulation">
<span class="header-section-number">2.4.2</span> Summarize simulation</h3>
<p>Now suppose we want the mean for the simulation outcomes array. Use <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> to iterate over indices of the array.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/functions-on-array_efe575b3a27163a0516c1ae631244759">
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># calc mean of a particular iteration</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">my_beta_sims_array</span><span class="op">[</span> ,<span class="fl">1</span> , <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4665157</code></pre>
</div>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># loop over each column in each layer (thus averaging over the rows) with apply()</span></span>
<span><span class="va">beta_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">my_beta_sims_array</span>,</span>
<span>                    MARGIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>                    FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">beta_means</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:10, 1:10] 0.467 0.755 0.788 0.734 0.9 ...</code></pre>
</div>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># map way requires different functions</span></span>
<span><span class="co"># -&gt; need to convert the array to a list first with array_tree() (a hierarchical list), and then map at the second level</span></span>
<span><span class="co"># -&gt; then simplify</span></span>
<span><span class="co"># NOTE -&gt; changing the order of dimensions in MARGIN transposes the result (i.e. order matters)</span></span>
<span><span class="va">beta_means2</span> <span class="op">&lt;-</span> <span class="va">my_beta_sims_array</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/array-coercion.html">array_tree</a></span><span class="op">(</span>margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># first level list will be the layers, then the columns result$layer[[column]]</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_depth.html">map_depth</a></span><span class="op">(</span>.depth <span class="op">=</span> <span class="fl">2</span>, .f <span class="op">=</span> <span class="va">mean</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">cbind</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">beta_means2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"shape1_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">param_combinations</span><span class="op">$</span><span class="va">shape1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">beta_means2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"shape2_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">param_combinations</span><span class="op">$</span><span class="va">shape2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compare two different methods</span></span>
<span><span class="va">beta_means2</span> <span class="op">==</span> <span class="va">beta_means</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           shape2_0.5 shape2_1 shape2_1.5 shape2_2 shape2_2.5 shape2_3
shape1_0.5       TRUE     TRUE       TRUE     TRUE       TRUE     TRUE
shape1_1         TRUE     TRUE       TRUE     TRUE       TRUE     TRUE
shape1_1.5       TRUE     TRUE       TRUE     TRUE       TRUE     TRUE
shape1_2         TRUE     TRUE       TRUE     TRUE       TRUE     TRUE
shape1_2.5       TRUE     TRUE       TRUE     TRUE       TRUE     TRUE
shape1_3         TRUE     TRUE       TRUE     TRUE       TRUE     TRUE
shape1_3.5       TRUE     TRUE       TRUE     TRUE       TRUE     TRUE
shape1_4         TRUE     TRUE       TRUE     TRUE       TRUE     TRUE
shape1_4.5       TRUE     TRUE       TRUE     TRUE       TRUE     TRUE
shape1_5         TRUE     TRUE       TRUE     TRUE       TRUE     TRUE
           shape2_3.5 shape2_4 shape2_4.5 shape2_5
shape1_0.5       TRUE     TRUE       TRUE     TRUE
shape1_1         TRUE     TRUE       TRUE     TRUE
shape1_1.5       TRUE     TRUE       TRUE     TRUE
shape1_2         TRUE     TRUE       TRUE     TRUE
shape1_2.5       TRUE     TRUE       TRUE     TRUE
shape1_3         TRUE     TRUE       TRUE     TRUE
shape1_3.5       TRUE     TRUE       TRUE     TRUE
shape1_4         TRUE     TRUE       TRUE     TRUE
shape1_4.5       TRUE     TRUE       TRUE     TRUE
shape1_5         TRUE     TRUE       TRUE     TRUE</code></pre>
</div>
</div>
<p>Now we can check our simulated means against a theoretical mean: <span class="math inline">\(X \sim \text{beta}(\alpha, \beta) \Longrightarrow E(X) = \frac{\alpha}{\alpha + \beta}\)</span>.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/compute-means_b12006796959dafe811d2741e28bd0ab">
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># define function to calculate theoretical beta mean</span></span>
<span><span class="va">theoretical_beta_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">alpha</span> <span class="op">/</span> <span class="op">(</span><span class="va">alpha</span> <span class="op">+</span> <span class="va">beta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># create a 10 x 10 matrix of the theoretical means for the beta distribution using the function above</span></span>
<span><span class="va">theoretical_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span>FUN <span class="op">=</span> <span class="va">theoretical_beta_mean</span>,</span>
<span>                            alpha <span class="op">=</span> <span class="va">param_combinations</span><span class="op">$</span><span class="va">shape1</span>,</span>
<span>                            beta <span class="op">=</span> <span class="va">param_combinations</span><span class="op">$</span><span class="va">shape2</span>,</span>
<span>                            SIMPLIFY <span class="op">=</span> <span class="st">"array"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">theoretical_means</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">theoretical_means</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]
 [1,] 0.5000000 0.3333333 0.2500000 0.2000000 0.1666667 0.1428571 0.1250000
 [2,] 0.6666667 0.5000000 0.4000000 0.3333333 0.2857143 0.2500000 0.2222222
 [3,] 0.7500000 0.6000000 0.5000000 0.4285714 0.3750000 0.3333333 0.3000000
 [4,] 0.8000000 0.6666667 0.5714286 0.5000000 0.4444444 0.4000000 0.3636364
 [5,] 0.8333333 0.7142857 0.6250000 0.5555556 0.5000000 0.4545455 0.4166667
 [6,] 0.8571429 0.7500000 0.6666667 0.6000000 0.5454545 0.5000000 0.4615385
 [7,] 0.8750000 0.7777778 0.7000000 0.6363636 0.5833333 0.5384615 0.5000000
 [8,] 0.8888889 0.8000000 0.7272727 0.6666667 0.6153846 0.5714286 0.5333333
 [9,] 0.9000000 0.8181818 0.7500000 0.6923077 0.6428571 0.6000000 0.5625000
[10,] 0.9090909 0.8333333 0.7692308 0.7142857 0.6666667 0.6250000 0.5882353
           [,8]      [,9]      [,10]
 [1,] 0.1111111 0.1000000 0.09090909
 [2,] 0.2000000 0.1818182 0.16666667
 [3,] 0.2727273 0.2500000 0.23076923
 [4,] 0.3333333 0.3076923 0.28571429
 [5,] 0.3846154 0.3571429 0.33333333
 [6,] 0.4285714 0.4000000 0.37500000
 [7,] 0.4666667 0.4375000 0.41176471
 [8,] 0.5000000 0.4705882 0.44444444
 [9,] 0.5294118 0.5000000 0.47368421
[10,] 0.5555556 0.5263158 0.50000000</code></pre>
</div>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># now use map2, then simplify to vector and convert to matrix</span></span>
<span><span class="va">theoretical_means2</span> <span class="op">&lt;-</span> <span class="va">param_combinations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="op">{</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">shape1</span>, <span class="va">.</span><span class="op">$</span><span class="va">shape2</span>, \<span class="op">(</span><span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span> <span class="fu">theoretical_beta_mean</span><span class="op">(</span><span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">as_vector</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">theoretical_means2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">theoretical_means</span> <span class="op">==</span> <span class="va">theoretical_means2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
 [1,] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE  TRUE
 [2,] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE  TRUE
 [3,] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE  TRUE
 [4,] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE  TRUE
 [5,] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE  TRUE
 [6,] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE  TRUE
 [7,] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE  TRUE
 [8,] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE  TRUE
 [9,] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE  TRUE
[10,] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE  TRUE</code></pre>
</div>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># compare a few means</span></span>
<span><span class="co"># -&gt; note that for some reason beta_means2 is stored as a list but displaying like a matrix? but it is correct</span></span>
<span><span class="va">theoretical_means</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">7</span><span class="op">]</span> <span class="op">-</span> <span class="va">beta_means2</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">7</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.04582796</code></pre>
</div>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theoretical_means</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">]</span> <span class="op">-</span> <span class="va">beta_means2</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.04812996</code></pre>
</div>
</div>
</section><section id="entire-workflow" class="level3" data-number="2.4.3"><h3 data-number="2.4.3" class="anchored" data-anchor-id="entire-workflow">
<span class="header-section-number">2.4.3</span> Entire workflow</h3>
<p>To confirm the simulated data is correct, we can do a bigger simulation (more iterations) and then compare to the theoretical means.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/entire-workflow_6b77d9c43dd8e0c59ca09757103ac80b">
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># steps of simulation</span></span>
<span><span class="co"># -&gt; simulate data based on parameter combinations</span></span>
<span><span class="co"># -&gt; keep in list form where each list all the iterations for a parameter pair</span></span>
<span><span class="co"># -&gt; then unpack and convert to 10 x 10 matrix</span></span>
<span><span class="va">beta_simulation</span> <span class="op">&lt;-</span> <span class="va">param_combinations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="op">{</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">shape1</span>, <span class="va">.</span><span class="op">$</span><span class="va">shape2</span>, \<span class="op">(</span><span class="va">shape1</span>, <span class="va">shape2</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, shape1 <span class="op">=</span> <span class="va">shape1</span>, shape2 <span class="op">=</span> <span class="va">shape2</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">rbind</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">beta_simulation</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compare simulated and theoretical means</span></span>
<span><span class="va">theoretical_means</span> <span class="op">-</span> <span class="va">beta_simulation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               [,1]         [,2]          [,3]          [,4]          [,5]
 [1,] -0.0142132012  0.003116614  0.0066012052 -0.0007622041  0.0062963343
 [2,]  0.0100067763  0.013270507 -0.0080331498  0.0123747272 -0.0046966411
 [3,]  0.0013483645 -0.007303189  0.0002846672  0.0021937513 -0.0023641170
 [4,] -0.0049458229  0.001847125  0.0040680799 -0.0040171170 -0.0089856956
 [5,] -0.0030957859  0.007595387 -0.0110157358  0.0018415398  0.0025003515
 [6,] -0.0043906746 -0.016080434  0.0009762396  0.0004213263  0.0014271047
 [7,]  0.0021821881  0.000129152  0.0180482395 -0.0047434431  0.0090941503
 [8,]  0.0008452475 -0.003486720  0.0009930790  0.0001847752 -0.0012385592
 [9,]  0.0033797827 -0.008557892 -0.0031519925 -0.0061728992 -0.0003760041
[10,]  0.0069978255  0.005697019 -0.0056672028 -0.0033885516  0.0038704320
               [,6]          [,7]          [,8]          [,9]         [,10]
 [1,]  3.054469e-03 -0.0015928837  0.0052464166 -0.0032251524 -0.0005184324
 [2,] -4.201410e-03  0.0030931652 -0.0054156716 -0.0026176455  0.0022975290
 [3,] -2.646566e-03  0.0052396896  0.0015635734  0.0088116515  0.0036147661
 [4,]  1.740050e-03 -0.0013558452  0.0071321635 -0.0066822756 -0.0021917885
 [5,]  3.218331e-03 -0.0025266934  0.0006006874  0.0006198128 -0.0031791894
 [6,] -5.832885e-03  0.0006288153 -0.0005570289 -0.0002017058  0.0006356175
 [7,] -1.869705e-03  0.0001812270 -0.0017629098  0.0002394587  0.0002452288
 [8,] -2.764513e-03  0.0054854862  0.0025546891 -0.0006957005  0.0014663981
 [9,]  2.794567e-03 -0.0044905333  0.0013261447 -0.0038680504  0.0025212857
[10,]  5.620049e-05  0.0051221631  0.0044932398 -0.0037773398 -0.0024546055</code></pre>
</div>
</div>
</section></section><section id="writing-modular-functions" class="level2" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="writing-modular-functions">
<span class="header-section-number">2.5</span> Writing Modular Functions</h2>
<p>When you are writing functions to do a complex task, try to identify the system of simple tasks that are needed to accomplish it step-by-step. For example we might consider building functions to help us to automate the process of running stepwise selection based on AIC, then outputting a model object that we can use for prediction, or inference.</p>
<p>We might initially think of one big function that can take a model matrix, X, and does a bunch of linear algebra to get beta estimates, calculates an AIC for the fitted model, then removes a columns from X to reduce the model… and repeat… a lot. Is that what we find inside the <code><a href="https://rdrr.io/r/stats/step.html">step()</a></code> function? Run <code>body(step)</code> to see.</p>
<p>It isn’t doing any of the linear algebra and AIC calculations we expected! The body of the step function is filled with, well more functions! It is function pinata!</p>
<p>What we find is that the <code><a href="https://rdrr.io/r/stats/step.html">step()</a></code> function calls many other functions to do the individual smaller tasks that make up the complex procedure. If we search closely, there is a function for dropping a row, <code><a href="https://rdrr.io/r/stats/add1.html">drop1()</a></code>, within a <code>while</code> loop that keeps dropping rows until a condition is met. There is a function for updating the fit of the model, <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code>, and calculating the AIC, <code><a href="https://rdrr.io/r/stats/extractAIC.html">extractAIC()</a></code>. There is even a function created at the start of the body that are used to help organize and return a helpful print statement about the stepwise procedure: <code>step.results()</code>.</p>
<p>These functions are often times called “helper functions”, completing the sub-tasks of the primary function. This modular format allows each function to complete a single simple task, and when used in combination, achieve a complex task.</p>
<p>Thus, when modularizing code, the end goal to have one “overall” function that just has some helper functions within. On the way to having modularized code, is it better to start with an overall function and add modules sequentially (so e.g.&nbsp;if we call the overall, it will call module 1, so we check if that works; then add module 2 and call the overall which runs mod 1 and mod 2)…. etc.</p>
<p>Below is an example (NOT RUN) to demostrate how helper functions can be used so that the overall function is body is relatively simple, all the work is being done by other functions. The overall function should be readable step by step.</p>
<div class="cell" data-hash="using-and-building-functions_cache/html/helper-functions_81a9ac45265dd33027af13d87dd29102">
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># main data simulation function</span></span>
<span><span class="co"># write a function to simulate a dataset for an n x p dataset for a regression model where q of the variables are inactive (signal variables)</span></span>
<span><span class="va">make_sim_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">100</span>, <span class="va">p</span> <span class="op">=</span> <span class="fl">20</span>, <span class="va">q</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">b</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="va">sd_y</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">sd_x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># generate a n(iteration in sample) x p(sample) matrix from rnorm(0, sd_X)</span></span>
<span>  <span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sd_x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># specify population coefficients</span></span>
<span>  <span class="va">betas</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">b</span>, <span class="va">q</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span><span class="op">-</span><span class="va">q</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># generate responses</span></span>
<span>  <span class="va">y</span> <span class="op">=</span> <span class="op">(</span><span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">betas</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>,<span class="fl">0</span>, <span class="va">sd_y</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># combine data</span></span>
<span>  <span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">y</span>,<span class="va">X</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># helper functions for running the experiment with variable selection</span></span>
<span></span>
<span><span class="co"># function for choosing with stepwise and fitting a regression</span></span>
<span><span class="va">step_var_mod</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">step_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span> , data <span class="op">=</span> <span class="va">df</span><span class="op">)</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">step_selected</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># function for choosing with lasso and fitting regression</span></span>
<span><span class="va">lasso_var_mod</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">cv.out</span> <span class="op">=</span> <span class="fu">cv.glmnet</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df</span><span class="op">[</span> ,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">==</span> <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                      y <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">y</span>, alpha <span class="op">=</span> <span class="fl">1</span>, type.measure <span class="op">=</span> <span class="st">"deviance"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">lasso_mod</span> <span class="op">=</span> <span class="fu">glmnet</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">==</span> <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                      y <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">y</span>, alpha<span class="op">=</span><span class="fl">1</span>, lambda <span class="op">=</span> <span class="va">cv.out</span><span class="op">$</span><span class="va">lambda.1se</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">lasso_vars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lasso_mod</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">lasso_mod</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lasso_vars</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">lasso_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lasso_mod</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">lasso_selected</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"y ~ 1 + "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">lasso_vars</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">lasso_selected</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># function for finding number of variables included</span></span>
<span><span class="va">select_var_count</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lin_mod</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lin_mod</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># function for finding 10-fold cross validated RMSE</span></span>
<span><span class="va">select_cv_rmse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lin_mod</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">cv_result</span> <span class="op">=</span> <span class="fu">train</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="va">lin_mod</span><span class="op">)</span>, </span>
<span>    data <span class="op">=</span> <span class="va">lin_mod</span><span class="op">$</span><span class="va">model</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    trControl <span class="op">=</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, number <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">cv_result</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">RMSE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># function to run trial </span></span>
<span><span class="va">run_trial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">selection_alg</span>, <span class="va">df</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">start_time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_mod</span> <span class="op">=</span> <span class="fu">selection_alg</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="co"># not sure where this function comes from</span></span>
<span>  </span>
<span>  <span class="va">end_time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>var_count <span class="op">=</span> <span class="fu">select_var_count</span><span class="op">(</span><span class="va">tmp_mod</span><span class="op">)</span>,</span>
<span>                    rmse <span class="op">=</span> <span class="fu">select_cv_rmse</span><span class="op">(</span><span class="va">tmp_mod</span><span class="op">)</span>, <span class="co"># nor this function</span></span>
<span>                    time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">end_time</span>, <span class="va">start_time</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># make into a function of n_sims, n, p and q</span></span>
<span><span class="va">sim_var_select</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_sim</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">100</span>, <span class="va">p</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">q</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">var_select_ftn</span> <span class="op">=</span> <span class="va">step_var_mod</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">results</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sim</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu">make_sim_data</span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, p <span class="op">=</span> <span class="va">p</span>,q <span class="op">=</span> <span class="va">q</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">results</span>, <span class="fu">run_trial</span><span class="op">(</span><span class="va">var_select_ftn</span>, <span class="va">sim_data</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./beyond-dataframes.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Beyond Dataframes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./permutation-tests.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Permutation Tests</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb128" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Using and Building Functions {#sec-using-and-building-functions}</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-prereqs</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr options</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"_common.R"</span>)</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview </span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>This section will discuss R functions. Functions are the engines that define how to DO things with your data objects in R. If data objects are the "nouns", then functions are the "verbs" of the R language. </span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a>Why build functions?</span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Because it is fun (for us nerdy people).</span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Because we find ourselves doing the same task multiple times throughout our code, and realize that each iteration is mostly the same process using slightly different values or variables. </span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Because we want to avoid copy/paste related errors.</span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Because we want to make our code more readable.</span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a>This will discuss the basic structure and components of a function, how a function is created, passing parameters implicitly versus explicitly in a function call, name masking in nested environments, and infix operators.</span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a>Below are links to supplementary resources about building functions in R: </span>
<span id="cb128-32"><a href="#cb128-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Advanced R Functions Chapter</span><span class="co">](http://adv-r.had.co.nz/Functions.html)</span></span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Additional Functions Reading from R for Data Science E-book</span><span class="co">](https://r4ds.hadley.nz/functions)</span></span>
<span id="cb128-35"><a href="#cb128-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-36"><a href="#cb128-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## R Function Basics - Components </span></span>
<span id="cb128-37"><a href="#cb128-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-38"><a href="#cb128-38" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;``To understand computations in R, two slogans are helpful: Everything that exists is an object. Everything that happens is a function call.''</span></span>
<span id="cb128-39"><a href="#cb128-39" aria-hidden="true" tabindex="-1"></a><span class="at">  — John Chambers</span></span>
<span id="cb128-40"><a href="#cb128-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-41"><a href="#cb128-41" aria-hidden="true" tabindex="-1"></a>Formals: The defined parameters of a function. Think of these as the set of data objects and options that can be defined by the programmer when a function is used.</span>
<span id="cb128-42"><a href="#cb128-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-43"><a href="#cb128-43" aria-hidden="true" tabindex="-1"></a>For these exercises we will consider the following functions:</span>
<span id="cb128-44"><a href="#cb128-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-45"><a href="#cb128-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`mean()`</span> from base R</span>
<span id="cb128-46"><a href="#cb128-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`ggplot()`</span> from the ggplot2 package</span>
<span id="cb128-47"><a href="#cb128-47" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`%&gt;%`</span> piping symbol from the dplyr package</span>
<span id="cb128-48"><a href="#cb128-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-51"><a href="#cb128-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-52"><a href="#cb128-52" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: function-calls </span></span>
<span id="cb128-53"><a href="#cb128-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-54"><a href="#cb128-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb128-55"><a href="#cb128-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-56"><a href="#cb128-56" aria-hidden="true" tabindex="-1"></a><span class="co"># a function without parentheses prints what it is</span></span>
<span id="cb128-57"><a href="#cb128-57" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; with the parenthesis, it tells R to run it</span></span>
<span id="cb128-58"><a href="#cb128-58" aria-hidden="true" tabindex="-1"></a>mean</span>
<span id="cb128-59"><a href="#cb128-59" aria-hidden="true" tabindex="-1"></a>ggplot</span>
<span id="cb128-60"><a href="#cb128-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-61"><a href="#cb128-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-62"><a href="#cb128-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-63"><a href="#cb128-63" aria-hidden="true" tabindex="-1"></a>Pipe</span>
<span id="cb128-64"><a href="#cb128-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-65"><a href="#cb128-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is actually quite a complex function (yes, a function) (things like this are called infix operator). Infix operators go in between arguments.</span>
<span id="cb128-66"><a href="#cb128-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-67"><a href="#cb128-67" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Can surround an infix operator with tick marks to see what this function is actually doing.</span>
<span id="cb128-68"><a href="#cb128-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-71"><a href="#cb128-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-72"><a href="#cb128-72" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pipe</span></span>
<span id="cb128-73"><a href="#cb128-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-74"><a href="#cb128-74" aria-hidden="true" tabindex="-1"></a><span class="co"># infix operator: pipe</span></span>
<span id="cb128-75"><a href="#cb128-75" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%&gt;%</span><span class="st">`</span></span>
<span id="cb128-76"><a href="#cb128-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-77"><a href="#cb128-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-78"><a href="#cb128-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-79"><a href="#cb128-79" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Another example is <span class="in">`+`</span>. This is a primitive function, which just means that R doesn't evaluate it. It sends it down and is evaluated in C (because it is more efficient).</span>
<span id="cb128-80"><a href="#cb128-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-83"><a href="#cb128-83" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-84"><a href="#cb128-84" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: addition</span></span>
<span id="cb128-85"><a href="#cb128-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-86"><a href="#cb128-86" aria-hidden="true" tabindex="-1"></a><span class="co"># infix operator as function</span></span>
<span id="cb128-87"><a href="#cb128-87" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">+</span><span class="st">`</span>(<span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb128-88"><a href="#cb128-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-89"><a href="#cb128-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-90"><a href="#cb128-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-91"><a href="#cb128-91" aria-hidden="true" tabindex="-1"></a><span class="fu">### Formals</span></span>
<span id="cb128-92"><a href="#cb128-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-93"><a href="#cb128-93" aria-hidden="true" tabindex="-1"></a>What are the formals for these functions?</span>
<span id="cb128-94"><a href="#cb128-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-95"><a href="#cb128-95" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`?formals()`</span>: Formals are things that we define to change the behavior of the outcome.</span>
<span id="cb128-96"><a href="#cb128-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-99"><a href="#cb128-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-100"><a href="#cb128-100" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: formals</span></span>
<span id="cb128-101"><a href="#cb128-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-102"><a href="#cb128-102" aria-hidden="true" tabindex="-1"></a><span class="co"># view formals</span></span>
<span id="cb128-103"><a href="#cb128-103" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(<span class="st">`</span><span class="at">%&gt;%</span><span class="st">`</span>)</span>
<span id="cb128-104"><a href="#cb128-104" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(mean)</span>
<span id="cb128-105"><a href="#cb128-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-106"><a href="#cb128-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-107"><a href="#cb128-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-108"><a href="#cb128-108" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`...`</span> are a special (very flexible, catch all) type of formal argument that we can put non-necessary arguments.</span>
<span id="cb128-109"><a href="#cb128-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-110"><a href="#cb128-110" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For example, with mean <span class="in">`mean(x, na.rm = TRUE)`</span>, this saves the value <span class="in">`TRUE`</span> to na.rm  argument and saves that value as the function is run.</span>
<span id="cb128-111"><a href="#cb128-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-112"><a href="#cb128-112" aria-hidden="true" tabindex="-1"></a><span class="fu">### Body </span></span>
<span id="cb128-113"><a href="#cb128-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-114"><a href="#cb128-114" aria-hidden="true" tabindex="-1"></a>The lines of code that will be run when the function is called. The body uses the formals and usually returns a result of some kind.</span>
<span id="cb128-115"><a href="#cb128-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-118"><a href="#cb128-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-119"><a href="#cb128-119" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: body</span></span>
<span id="cb128-120"><a href="#cb128-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-121"><a href="#cb128-121" aria-hidden="true" tabindex="-1"></a><span class="co"># body()</span></span>
<span id="cb128-122"><a href="#cb128-122" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>)</span>
<span id="cb128-123"><a href="#cb128-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-124"><a href="#cb128-124" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; returns null because the function isn't run in R</span></span>
<span id="cb128-125"><a href="#cb128-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-126"><a href="#cb128-126" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(ggplot)</span>
<span id="cb128-127"><a href="#cb128-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-128"><a href="#cb128-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-129"><a href="#cb128-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-130"><a href="#cb128-130" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that the code in the body is never commented because R strips away the comments when running to make its more compact. When we write functions, we add comments so the humans know what it does, but when it is stored they are removed to take up less space.</span>
<span id="cb128-131"><a href="#cb128-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-132"><a href="#cb128-132" aria-hidden="true" tabindex="-1"></a><span class="fu">### Environment </span></span>
<span id="cb128-133"><a href="#cb128-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-134"><a href="#cb128-134" aria-hidden="true" tabindex="-1"></a>The environment is the group of named objects which functions have access to. In other words, it is where the function will retrieve named objects used to execute the code from the body.</span>
<span id="cb128-135"><a href="#cb128-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-136"><a href="#cb128-136" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The global environment is everything that we have loaded in, created ourselves or in base R.</span>
<span id="cb128-137"><a href="#cb128-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-138"><a href="#cb128-138" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`ls()`</span> tells you what you have created / assigned in the global environment (to get, set, test for and create environments, use <span class="in">`environment()`</span>).</span>
<span id="cb128-139"><a href="#cb128-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-142"><a href="#cb128-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-143"><a href="#cb128-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: global-environment</span></span>
<span id="cb128-144"><a href="#cb128-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-145"><a href="#cb128-145" aria-hidden="true" tabindex="-1"></a><span class="co"># ?environment()</span></span>
<span id="cb128-146"><a href="#cb128-146" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>()</span>
<span id="cb128-147"><a href="#cb128-147" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb128-148"><a href="#cb128-148" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>()</span>
<span id="cb128-149"><a href="#cb128-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-150"><a href="#cb128-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-151"><a href="#cb128-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-152"><a href="#cb128-152" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When calling functions, they have access to the names of objects in the namespace. It can map the name to where the object is stored. So it retrieves values through the names, so names are very powerful and why we can do computation work that is readable. </span>
<span id="cb128-153"><a href="#cb128-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-156"><a href="#cb128-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-157"><a href="#cb128-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: namespaces</span></span>
<span id="cb128-158"><a href="#cb128-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-159"><a href="#cb128-159" aria-hidden="true" tabindex="-1"></a><span class="co"># y is now in the namespace, so we have access to it</span></span>
<span id="cb128-160"><a href="#cb128-160" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; the name gets mapped to its value</span></span>
<span id="cb128-161"><a href="#cb128-161" aria-hidden="true" tabindex="-1"></a>y<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb128-162"><a href="#cb128-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-163"><a href="#cb128-163" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span>
<span id="cb128-164"><a href="#cb128-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-165"><a href="#cb128-165" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; we were able to find this because head and iris are a namespace in the global environment</span></span>
<span id="cb128-166"><a href="#cb128-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-167"><a href="#cb128-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-168"><a href="#cb128-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-169"><a href="#cb128-169" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When we load a library, we are loading a namespace that has access to all the function names and dataset names in the library (package). Everything is a named object (objects, functions, etc.) and they are saved somewhere. The environment is where R finds the object.</span>
<span id="cb128-170"><a href="#cb128-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-171"><a href="#cb128-171" aria-hidden="true" tabindex="-1"></a>Local namespaces</span>
<span id="cb128-172"><a href="#cb128-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-173"><a href="#cb128-173" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When a function is called, a local namespace is created within the global environment (like a subspace of the global environment).</span>
<span id="cb128-174"><a href="#cb128-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-175"><a href="#cb128-175" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When code is run in this local environment, R has access to all objects contained in the global environment.</span>
<span id="cb128-176"><a href="#cb128-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-177"><a href="#cb128-177" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The primary difference is that when the local namespace is created, the formal argument names and their defined values are written into the local namespace. If these objects already exist in the global environment, they are overwritten locally while the function code is running. This is referred to as **name masking**.</span>
<span id="cb128-178"><a href="#cb128-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-179"><a href="#cb128-179" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>After the function code has completed running, the local environment is deleted. Thus, the local environment of a function is both nested in the global environment and is temporary.</span>
<span id="cb128-180"><a href="#cb128-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-183"><a href="#cb128-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-184"><a href="#cb128-184" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: local-arguments</span></span>
<span id="cb128-185"><a href="#cb128-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-186"><a href="#cb128-186" aria-hidden="true" tabindex="-1"></a><span class="co"># when we call the mean function, x is defined locally but not globally</span></span>
<span id="cb128-187"><a href="#cb128-187" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="at">x =</span> y)</span>
<span id="cb128-188"><a href="#cb128-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-189"><a href="#cb128-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-190"><a href="#cb128-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-191"><a href="#cb128-191" aria-hidden="true" tabindex="-1"></a><span class="fu">## Creating Functions</span></span>
<span id="cb128-192"><a href="#cb128-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-193"><a href="#cb128-193" aria-hidden="true" tabindex="-1"></a>To create a function you must define the formals and body in using the <span class="in">`function()`</span> function, and assign the definition to a name.</span>
<span id="cb128-194"><a href="#cb128-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-195"><a href="#cb128-195" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Below we are giving a function as a value to the function name.</span>
<span id="cb128-196"><a href="#cb128-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-197"><a href="#cb128-197" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Functions are first class objects (they store expressions, rather than data values).</span>
<span id="cb128-198"><a href="#cb128-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-199"><a href="#cb128-199" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If there is a set of things we want to do, we can wrap a bunch of code into an expression by wrapping in curly brackets, then R thinks about it as one thing.</span>
<span id="cb128-200"><a href="#cb128-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-203"><a href="#cb128-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-204"><a href="#cb128-204" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: defining-functions</span></span>
<span id="cb128-205"><a href="#cb128-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-206"><a href="#cb128-206" aria-hidden="true" tabindex="-1"></a><span class="co"># writing functions</span></span>
<span id="cb128-207"><a href="#cb128-207" aria-hidden="true" tabindex="-1"></a>function_name <span class="ot">&lt;-</span> <span class="cf">function</span>(formal_arguments_go_here) {</span>
<span id="cb128-208"><a href="#cb128-208" aria-hidden="true" tabindex="-1"></a>  <span class="co"># code body expression goes here</span></span>
<span id="cb128-209"><a href="#cb128-209" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-210"><a href="#cb128-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-211"><a href="#cb128-211" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(function_name)</span>
<span id="cb128-212"><a href="#cb128-212" aria-hidden="true" tabindex="-1"></a><span class="fu">body</span>(function_name)</span>
<span id="cb128-213"><a href="#cb128-213" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(function_name)</span>
<span id="cb128-214"><a href="#cb128-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-215"><a href="#cb128-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-216"><a href="#cb128-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-217"><a href="#cb128-217" aria-hidden="true" tabindex="-1"></a>Also note, <span class="in">`function()`</span> is a very weird function, since the body argument goes outside the parentheses! Technically even the example above is a real function (albeit a boring one).</span>
<span id="cb128-218"><a href="#cb128-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-219"><a href="#cb128-219" aria-hidden="true" tabindex="-1"></a>Better example of simple function for adding up two numbers.</span>
<span id="cb128-220"><a href="#cb128-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-221"><a href="#cb128-221" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Give functions a name that indicate what it does (intuitive names help a great deal with readable code).</span>
<span id="cb128-222"><a href="#cb128-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-223"><a href="#cb128-223" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Style guide: Can use the assignment arrow <span class="in">`&lt;-`</span> for anytime something will be saved to the global environment (data values and functions), but within a function we can use <span class="in">`=`</span> because it is only found locally and is temporary.</span>
<span id="cb128-224"><a href="#cb128-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-225"><a href="#cb128-225" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`&lt;&lt;-`</span> Assigns values from a local environment (like a function call) and saves it in the global environment (this is a really bad idea because it could overwrite something that you already have in the global environment)</span>
<span id="cb128-226"><a href="#cb128-226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-227"><a href="#cb128-227" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Returning values: Functions implicitly return the last thing computed. So it is often a good idea to be explicit about what to return.</span>
<span id="cb128-228"><a href="#cb128-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-229"><a href="#cb128-229" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>All standalone functions should have explicit returns. When doing an on-the-fly function in an <span class="in">`sapply()`</span> for example, we can stylistically omit <span class="in">`return()`</span> and still have readable code.</span>
<span id="cb128-230"><a href="#cb128-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-233"><a href="#cb128-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-234"><a href="#cb128-234" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: defining-functions-assignment</span></span>
<span id="cb128-235"><a href="#cb128-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-236"><a href="#cb128-236" aria-hidden="true" tabindex="-1"></a><span class="co"># write function add two numbers</span></span>
<span id="cb128-237"><a href="#cb128-237" aria-hidden="true" tabindex="-1"></a>my_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb128-238"><a href="#cb128-238" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">=</span> x <span class="sc">+</span> y</span>
<span id="cb128-239"><a href="#cb128-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(val)</span>
<span id="cb128-240"><a href="#cb128-240" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-241"><a href="#cb128-241" aria-hidden="true" tabindex="-1"></a><span class="fu">my_sum</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb128-242"><a href="#cb128-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-243"><a href="#cb128-243" aria-hidden="true" tabindex="-1"></a><span class="co"># bad idea</span></span>
<span id="cb128-244"><a href="#cb128-244" aria-hidden="true" tabindex="-1"></a>my_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb128-245"><a href="#cb128-245" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">&lt;&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb128-246"><a href="#cb128-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(val)</span>
<span id="cb128-247"><a href="#cb128-247" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-248"><a href="#cb128-248" aria-hidden="true" tabindex="-1"></a><span class="co"># val isn't in the global environment</span></span>
<span id="cb128-249"><a href="#cb128-249" aria-hidden="true" tabindex="-1"></a><span class="fu">my_sum</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb128-250"><a href="#cb128-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-251"><a href="#cb128-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-252"><a href="#cb128-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-253"><a href="#cb128-253" aria-hidden="true" tabindex="-1"></a>More complex functions: In a legitimate function, to have our function behave differently, we can use some if and else statements that are usually triggered by a yes / no or true / false.</span>
<span id="cb128-254"><a href="#cb128-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-255"><a href="#cb128-255" aria-hidden="true" tabindex="-1"></a><span class="in">`sapply()`</span> is a function that calls other functions in an iterative way (really efficient for loop).</span>
<span id="cb128-256"><a href="#cb128-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-259"><a href="#cb128-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-260"><a href="#cb128-260" aria-hidden="true" tabindex="-1"></a><span class="co"># label: defining-functions-ifs</span></span>
<span id="cb128-261"><a href="#cb128-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-262"><a href="#cb128-262" aria-hidden="true" tabindex="-1"></a><span class="co"># now trying to do something cool (and / or breaking it)</span></span>
<span id="cb128-263"><a href="#cb128-263" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; on rare occasions, add some random error to the sum</span></span>
<span id="cb128-264"><a href="#cb128-264" aria-hidden="true" tabindex="-1"></a>my_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">mischief =</span> <span class="cn">TRUE</span>){</span>
<span id="cb128-265"><a href="#cb128-265" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(mischief <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb128-266"><a href="#cb128-266" aria-hidden="true" tabindex="-1"></a>    val <span class="ot">=</span> x <span class="sc">+</span> y</span>
<span id="cb128-267"><a href="#cb128-267" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb128-268"><a href="#cb128-268" aria-hidden="true" tabindex="-1"></a>    val <span class="ot">=</span> x <span class="sc">+</span> y <span class="sc">+</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">02</span>,.<span class="dv">96</span>,.<span class="dv">02</span>))</span>
<span id="cb128-269"><a href="#cb128-269" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb128-270"><a href="#cb128-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(val)</span>
<span id="cb128-271"><a href="#cb128-271" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-272"><a href="#cb128-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-273"><a href="#cb128-273" aria-hidden="true" tabindex="-1"></a><span class="co"># run the function 100 times using specified values for the arguments</span></span>
<span id="cb128-274"><a href="#cb128-274" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; not using the X in our function call</span></span>
<span id="cb128-275"><a href="#cb128-275" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, my_sum, <span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">2</span>)</span>
<span id="cb128-276"><a href="#cb128-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-277"><a href="#cb128-277" aria-hidden="true" tabindex="-1"></a><span class="co"># equivalent to</span></span>
<span id="cb128-278"><a href="#cb128-278" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb128-279"><a href="#cb128-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">my_sum</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb128-280"><a href="#cb128-280" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-281"><a href="#cb128-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-282"><a href="#cb128-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-283"><a href="#cb128-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-284"><a href="#cb128-284" aria-hidden="true" tabindex="-1"></a>Can return something more complex than just a data value by returning lists. Functions that output lists are kinda the next step of complex computing ideas.</span>
<span id="cb128-285"><a href="#cb128-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-288"><a href="#cb128-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-289"><a href="#cb128-289" aria-hidden="true" tabindex="-1"></a><span class="co"># label: defining-functions-return-list</span></span>
<span id="cb128-290"><a href="#cb128-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-291"><a href="#cb128-291" aria-hidden="true" tabindex="-1"></a><span class="co"># modify function to return a list with multiple objects in it</span></span>
<span id="cb128-292"><a href="#cb128-292" aria-hidden="true" tabindex="-1"></a>my_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">mischief =</span> <span class="cn">TRUE</span>){</span>
<span id="cb128-293"><a href="#cb128-293" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(mischief <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb128-294"><a href="#cb128-294" aria-hidden="true" tabindex="-1"></a>    val <span class="ot">=</span> x <span class="sc">+</span> y</span>
<span id="cb128-295"><a href="#cb128-295" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb128-296"><a href="#cb128-296" aria-hidden="true" tabindex="-1"></a>    val <span class="ot">=</span> x <span class="sc">+</span> y <span class="sc">+</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">02</span>,.<span class="dv">96</span>,.<span class="dv">02</span>))</span>
<span id="cb128-297"><a href="#cb128-297" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb128-298"><a href="#cb128-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">value =</span> val,</span>
<span id="cb128-299"><a href="#cb128-299" aria-hidden="true" tabindex="-1"></a>              <span class="at">mischief =</span> mischief))</span>
<span id="cb128-300"><a href="#cb128-300" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-301"><a href="#cb128-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-302"><a href="#cb128-302" aria-hidden="true" tabindex="-1"></a><span class="fu">my_sum</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb128-303"><a href="#cb128-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-304"><a href="#cb128-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-305"><a href="#cb128-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-306"><a href="#cb128-306" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calling a Function</span></span>
<span id="cb128-307"><a href="#cb128-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-308"><a href="#cb128-308" aria-hidden="true" tabindex="-1"></a>To call a function, you simply use its name and define any required formal arguments. Typically this is done within a set of parentheses directly following the function name. Only a few special cases break from that pattern. </span>
<span id="cb128-309"><a href="#cb128-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-310"><a href="#cb128-310" aria-hidden="true" tabindex="-1"></a>What is more important to focus on is **if** and **how** we define the arguments. We may choose to define nothing in the arguments and the function might still work. </span>
<span id="cb128-311"><a href="#cb128-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-314"><a href="#cb128-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-315"><a href="#cb128-315" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: args-null</span></span>
<span id="cb128-316"><a href="#cb128-316" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb128-317"><a href="#cb128-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-318"><a href="#cb128-318" aria-hidden="true" tabindex="-1"></a><span class="co"># write function that has no arguments to simply return this hardcoded value</span></span>
<span id="cb128-319"><a href="#cb128-319" aria-hidden="true" tabindex="-1"></a>no_arg <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb128-320"><a href="#cb128-320" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb128-321"><a href="#cb128-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb128-322"><a href="#cb128-322" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-323"><a href="#cb128-323" aria-hidden="true" tabindex="-1"></a><span class="fu">no_arg</span>()</span>
<span id="cb128-324"><a href="#cb128-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-325"><a href="#cb128-325" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; so it will generate an error if we tried to give it an argument that isn't defined in the function</span></span>
<span id="cb128-326"><a href="#cb128-326" aria-hidden="true" tabindex="-1"></a><span class="fu">no_arg</span>(<span class="at">x =</span> <span class="dv">20</span>)</span>
<span id="cb128-327"><a href="#cb128-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-328"><a href="#cb128-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-329"><a href="#cb128-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-330"><a href="#cb128-330" aria-hidden="true" tabindex="-1"></a>Typically these are made more flexible using dots <span class="in">`...`</span>. All this does is put the values into the local namespace and continues running the function. These are optional arguments.</span>
<span id="cb128-331"><a href="#cb128-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-334"><a href="#cb128-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-335"><a href="#cb128-335" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: args-dots</span></span>
<span id="cb128-336"><a href="#cb128-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-337"><a href="#cb128-337" aria-hidden="true" tabindex="-1"></a><span class="co"># define function wtih ... formal</span></span>
<span id="cb128-338"><a href="#cb128-338" aria-hidden="true" tabindex="-1"></a>no_arg2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...){</span>
<span id="cb128-339"><a href="#cb128-339" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb128-340"><a href="#cb128-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb128-341"><a href="#cb128-341" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-342"><a href="#cb128-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-343"><a href="#cb128-343" aria-hidden="true" tabindex="-1"></a><span class="co"># functions works with no arguments</span></span>
<span id="cb128-344"><a href="#cb128-344" aria-hidden="true" tabindex="-1"></a><span class="fu">no_arg2</span>() </span>
<span id="cb128-345"><a href="#cb128-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-346"><a href="#cb128-346" aria-hidden="true" tabindex="-1"></a><span class="co"># and now with arguments</span></span>
<span id="cb128-347"><a href="#cb128-347" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; it initializes the value of x, but then  overwrites the value of x internally</span></span>
<span id="cb128-348"><a href="#cb128-348" aria-hidden="true" tabindex="-1"></a><span class="fu">no_arg2</span>(<span class="at">x =</span> <span class="dv">20</span>)</span>
<span id="cb128-349"><a href="#cb128-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-350"><a href="#cb128-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-351"><a href="#cb128-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-352"><a href="#cb128-352" aria-hidden="true" tabindex="-1"></a>For "optional" arguments (arguments that sometimes matters and sometimes don't matter), we should define them as formal parameters with some default values. This way we can override them if we wanted to.</span>
<span id="cb128-353"><a href="#cb128-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-356"><a href="#cb128-356" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-357"><a href="#cb128-357" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: args-defaults</span></span>
<span id="cb128-358"><a href="#cb128-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-359"><a href="#cb128-359" aria-hidden="true" tabindex="-1"></a><span class="co"># add default value to argument</span></span>
<span id="cb128-360"><a href="#cb128-360" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; now it behaves typically how we want, but can change them if we want</span></span>
<span id="cb128-361"><a href="#cb128-361" aria-hidden="true" tabindex="-1"></a>no_arg3 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="dv">10</span>){</span>
<span id="cb128-362"><a href="#cb128-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb128-363"><a href="#cb128-363" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-364"><a href="#cb128-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-365"><a href="#cb128-365" aria-hidden="true" tabindex="-1"></a><span class="co"># this is the behavior we typically will want</span></span>
<span id="cb128-366"><a href="#cb128-366" aria-hidden="true" tabindex="-1"></a><span class="fu">no_arg3</span>()</span>
<span id="cb128-367"><a href="#cb128-367" aria-hidden="true" tabindex="-1"></a><span class="fu">no_arg3</span>(<span class="at">x =</span> <span class="dv">20</span>)</span>
<span id="cb128-368"><a href="#cb128-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-369"><a href="#cb128-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-370"><a href="#cb128-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-371"><a href="#cb128-371" aria-hidden="true" tabindex="-1"></a>The more important characteristics of function calls are related to how we define our arguments: implicitly and explicitly. If we rely on the default ordering of the arguements, then we are calling the arguments *implicitly*. If we refer to the argument by it's name while defining the values, then we are calling the argument *explicitly*. Often we use a mix of these methods, but it is important to be aware of how and why we choose to define our arguments.</span>
<span id="cb128-372"><a href="#cb128-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-373"><a href="#cb128-373" aria-hidden="true" tabindex="-1"></a>A function runs through all of the named arguments, then goes in order for the unnamed arguments.</span>
<span id="cb128-374"><a href="#cb128-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-377"><a href="#cb128-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-378"><a href="#cb128-378" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: arg_exp_implicit</span></span>
<span id="cb128-379"><a href="#cb128-379" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb128-380"><a href="#cb128-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-381"><a href="#cb128-381" aria-hidden="true" tabindex="-1"></a><span class="co"># all of the following are equivalent</span></span>
<span id="cb128-382"><a href="#cb128-382" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb128-383"><a href="#cb128-383" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb128-384"><a href="#cb128-384" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb128-385"><a href="#cb128-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-386"><a href="#cb128-386" aria-hidden="true" tabindex="-1"></a><span class="co"># the following is NOT equivalent</span></span>
<span id="cb128-387"><a href="#cb128-387" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; it is expecting a numeric first</span></span>
<span id="cb128-388"><a href="#cb128-388" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="cn">TRUE</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb128-389"><a href="#cb128-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-390"><a href="#cb128-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-391"><a href="#cb128-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-392"><a href="#cb128-392" aria-hidden="true" tabindex="-1"></a>Possible convention: Implicitly give the function data values first, then use explicit calling for the options (this will still be readable because the function name will indicate what it's going to do with the data values).</span>
<span id="cb128-393"><a href="#cb128-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-394"><a href="#cb128-394" aria-hidden="true" tabindex="-1"></a><span class="fu">### Automating procedures</span></span>
<span id="cb128-395"><a href="#cb128-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-396"><a href="#cb128-396" aria-hidden="true" tabindex="-1"></a>The following example demonstrates code that would be better served by constructing a function to accomplish the task.</span>
<span id="cb128-397"><a href="#cb128-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-400"><a href="#cb128-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-401"><a href="#cb128-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-change-to-functions-manual</span></span>
<span id="cb128-402"><a href="#cb128-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-403"><a href="#cb128-403" aria-hidden="true" tabindex="-1"></a><span class="co"># take the following olive oil data and standardize the columns</span></span>
<span id="cb128-404"><a href="#cb128-404" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdfCluster) <span class="co"># for the data</span></span>
<span id="cb128-405"><a href="#cb128-405" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(oliveoil) <span class="co"># ?oliveoil</span></span>
<span id="cb128-406"><a href="#cb128-406" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(oliveoil)</span>
<span id="cb128-407"><a href="#cb128-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-408"><a href="#cb128-408" aria-hidden="true" tabindex="-1"></a><span class="co"># start with a dataframe where create the z-scores for palmitic acid, then add the rest </span></span>
<span id="cb128-409"><a href="#cb128-409" aria-hidden="true" tabindex="-1"></a>oo_standardized <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb128-410"><a href="#cb128-410" aria-hidden="true" tabindex="-1"></a>  <span class="at">palmitic =</span> (oliveoil[,<span class="st">"palmitic"</span>]<span class="sc">-</span><span class="fu">mean</span>(oliveoil[,<span class="st">"palmitic"</span>]))<span class="sc">/</span><span class="fu">sd</span>(oliveoil[,<span class="st">"palmitic"</span>])</span>
<span id="cb128-411"><a href="#cb128-411" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb128-412"><a href="#cb128-412" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(oo_standardized)</span>
<span id="cb128-413"><a href="#cb128-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-414"><a href="#cb128-414" aria-hidden="true" tabindex="-1"></a><span class="co"># if wanted to do this manually for all columns we would do this</span></span>
<span id="cb128-415"><a href="#cb128-415" aria-hidden="true" tabindex="-1"></a>oo_standardized <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb128-416"><a href="#cb128-416" aria-hidden="true" tabindex="-1"></a>  <span class="at">palmitic =</span> (oliveoil[,<span class="st">"palmitic"</span>]<span class="sc">-</span><span class="fu">mean</span>(oliveoil[,<span class="st">"palmitic"</span>]))<span class="sc">/</span><span class="fu">sd</span>(oliveoil[,<span class="st">"palmitic"</span>]),</span>
<span id="cb128-417"><a href="#cb128-417" aria-hidden="true" tabindex="-1"></a>  <span class="at">palmitoleic =</span> (oliveoil[,<span class="st">"palmitoleic"</span>]<span class="sc">-</span><span class="fu">mean</span>(oliveoil[,<span class="st">"palmitoleic"</span>]))<span class="sc">/</span><span class="fu">sd</span>(oliveoil[,<span class="st">"palmitoleic"</span>]),</span>
<span id="cb128-418"><a href="#cb128-418" aria-hidden="true" tabindex="-1"></a>  <span class="at">stearic =</span> (oliveoil[,<span class="st">"stearic"</span>]<span class="sc">-</span><span class="fu">mean</span>(oliveoil[,<span class="st">"stearic"</span>]))<span class="sc">/</span><span class="fu">sd</span>(oliveoil[,<span class="st">"stearic"</span>]),</span>
<span id="cb128-419"><a href="#cb128-419" aria-hidden="true" tabindex="-1"></a>  <span class="at">oleic =</span> (oliveoil[,<span class="st">"oleic"</span>]<span class="sc">-</span><span class="fu">mean</span>(oliveoil[,<span class="st">"oleic"</span>]))<span class="sc">/</span><span class="fu">sd</span>(oliveoil[,<span class="st">"oleic"</span>]),</span>
<span id="cb128-420"><a href="#cb128-420" aria-hidden="true" tabindex="-1"></a>  <span class="at">linoleic =</span> (oliveoil[,<span class="st">"linoleic"</span>]<span class="sc">-</span><span class="fu">mean</span>(oliveoil[,<span class="st">"linoleic"</span>]))<span class="sc">/</span><span class="fu">sd</span>(oliveoil[,<span class="st">"linoleic"</span>]),</span>
<span id="cb128-421"><a href="#cb128-421" aria-hidden="true" tabindex="-1"></a>  <span class="at">linolenic =</span> (oliveoil[,<span class="st">"linolenic"</span>]<span class="sc">-</span><span class="fu">mean</span>(oliveoil[,<span class="st">"linolenic"</span>]))<span class="sc">/</span><span class="fu">sd</span>(oliveoil[,<span class="st">"linolenic"</span>]),</span>
<span id="cb128-422"><a href="#cb128-422" aria-hidden="true" tabindex="-1"></a>  <span class="at">arachidic =</span> (oliveoil[,<span class="st">"arachidic"</span>]<span class="sc">-</span><span class="fu">mean</span>(oliveoil[,<span class="st">"arachidic"</span>]))<span class="sc">/</span><span class="fu">sd</span>(oliveoil[,<span class="st">"arachidic"</span>]),</span>
<span id="cb128-423"><a href="#cb128-423" aria-hidden="true" tabindex="-1"></a>  <span class="at">eicosenoic =</span> (oliveoil[,<span class="st">"eicosenoic"</span>]<span class="sc">-</span><span class="fu">mean</span>(oliveoil[,<span class="st">"eicosenoic"</span>]))<span class="sc">/</span><span class="fu">sd</span>(oliveoil[,<span class="st">"eicosenoic"</span>])</span>
<span id="cb128-424"><a href="#cb128-424" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb128-425"><a href="#cb128-425" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(oo_standardized)</span>
<span id="cb128-426"><a href="#cb128-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-427"><a href="#cb128-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-428"><a href="#cb128-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-429"><a href="#cb128-429" aria-hidden="true" tabindex="-1"></a>Could do this (slighlty) better with a function, rather than copy and paste and change column names.</span>
<span id="cb128-430"><a href="#cb128-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-433"><a href="#cb128-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-434"><a href="#cb128-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-change-to-functions-function</span></span>
<span id="cb128-435"><a href="#cb128-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-436"><a href="#cb128-436" aria-hidden="true" tabindex="-1"></a><span class="co"># write function to take a variable name and return the standardized column</span></span>
<span id="cb128-437"><a href="#cb128-437" aria-hidden="true" tabindex="-1"></a>oo_stand <span class="ot">&lt;-</span> <span class="cf">function</span>(varname) {</span>
<span id="cb128-438"><a href="#cb128-438" aria-hidden="true" tabindex="-1"></a>  (oliveoil[,varname]<span class="sc">-</span><span class="fu">mean</span>(oliveoil[,varname]))<span class="sc">/</span><span class="fu">sd</span>(oliveoil[,varname])</span>
<span id="cb128-439"><a href="#cb128-439" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-440"><a href="#cb128-440" aria-hidden="true" tabindex="-1"></a><span class="fu">oo_stand</span>(<span class="st">"palmitic"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb128-441"><a href="#cb128-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-442"><a href="#cb128-442" aria-hidden="true" tabindex="-1"></a><span class="co"># building the standardized data almost as repetitive as previous approach</span></span>
<span id="cb128-443"><a href="#cb128-443" aria-hidden="true" tabindex="-1"></a>oo_standardized2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb128-444"><a href="#cb128-444" aria-hidden="true" tabindex="-1"></a>  <span class="at">palmitic =</span>  <span class="fu">oo_stand</span>(<span class="st">"palmitic"</span>),</span>
<span id="cb128-445"><a href="#cb128-445" aria-hidden="true" tabindex="-1"></a>  <span class="at">palmitoleic =</span>  <span class="fu">oo_stand</span>(<span class="st">"palmitoleic"</span>),</span>
<span id="cb128-446"><a href="#cb128-446" aria-hidden="true" tabindex="-1"></a>  <span class="at">stearic =</span>  <span class="fu">oo_stand</span>(<span class="st">"stearic"</span>),</span>
<span id="cb128-447"><a href="#cb128-447" aria-hidden="true" tabindex="-1"></a>  <span class="at">oleic =</span>  <span class="fu">oo_stand</span>(<span class="st">"oleic"</span>),</span>
<span id="cb128-448"><a href="#cb128-448" aria-hidden="true" tabindex="-1"></a>  <span class="at">linoleic =</span>  <span class="fu">oo_stand</span>(<span class="st">"linoleic"</span>),</span>
<span id="cb128-449"><a href="#cb128-449" aria-hidden="true" tabindex="-1"></a>  <span class="at">linolenic =</span>  <span class="fu">oo_stand</span>(<span class="st">"linolenic"</span>),</span>
<span id="cb128-450"><a href="#cb128-450" aria-hidden="true" tabindex="-1"></a>  <span class="at">arachidic =</span>  <span class="fu">oo_stand</span>(<span class="st">"arachidic"</span>),</span>
<span id="cb128-451"><a href="#cb128-451" aria-hidden="true" tabindex="-1"></a>  <span class="at">eicosenoic =</span>  <span class="fu">oo_stand</span>(<span class="st">"eicosenoic"</span>)</span>
<span id="cb128-452"><a href="#cb128-452" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb128-453"><a href="#cb128-453" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(oo_standardized2)</span>
<span id="cb128-454"><a href="#cb128-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-455"><a href="#cb128-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-456"><a href="#cb128-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-457"><a href="#cb128-457" aria-hidden="true" tabindex="-1"></a>Next, can do this iteratively with for-loops to first print the result (for demonstration) and then to store the result.</span>
<span id="cb128-458"><a href="#cb128-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-461"><a href="#cb128-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-462"><a href="#cb128-462" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-change-to-functions-for-loops</span></span>
<span id="cb128-463"><a href="#cb128-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-464"><a href="#cb128-464" aria-hidden="true" tabindex="-1"></a><span class="co"># intitialize names</span></span>
<span id="cb128-465"><a href="#cb128-465" aria-hidden="true" tabindex="-1"></a>acids <span class="ot">&lt;-</span> <span class="fu">names</span>(oliveoil[<span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb128-466"><a href="#cb128-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-467"><a href="#cb128-467" aria-hidden="true" tabindex="-1"></a><span class="co"># loop over names and print first few standardized observations</span></span>
<span id="cb128-468"><a href="#cb128-468" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (acid_name <span class="cf">in</span> acids){</span>
<span id="cb128-469"><a href="#cb128-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">oo_stand</span>(acid_name)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb128-470"><a href="#cb128-470" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-471"><a href="#cb128-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-472"><a href="#cb128-472" aria-hidden="true" tabindex="-1"></a><span class="co"># initialization storage space for transformed values</span></span>
<span id="cb128-473"><a href="#cb128-473" aria-hidden="true" tabindex="-1"></a>oo_standardized3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(oliveoil) <span class="sc">*</span> <span class="dv">8</span>), </span>
<span id="cb128-474"><a href="#cb128-474" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nrow =</span> <span class="fu">nrow</span>(oliveoil)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-475"><a href="#cb128-475" aria-hidden="true" tabindex="-1"></a>  as.data.frame</span>
<span id="cb128-476"><a href="#cb128-476" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(oo_standardized3) <span class="ot">&lt;-</span> <span class="fu">names</span>(oliveoil)[<span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb128-477"><a href="#cb128-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-478"><a href="#cb128-478" aria-hidden="true" tabindex="-1"></a><span class="co"># loop over the acid names</span></span>
<span id="cb128-479"><a href="#cb128-479" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (acid_name <span class="cf">in</span> acids){</span>
<span id="cb128-480"><a href="#cb128-480" aria-hidden="true" tabindex="-1"></a>  oo_standardized3[,acid_name] <span class="ot">&lt;-</span> <span class="fu">oo_stand</span>(acid_name)</span>
<span id="cb128-481"><a href="#cb128-481" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-482"><a href="#cb128-482" aria-hidden="true" tabindex="-1"></a><span class="co"># check the outcome</span></span>
<span id="cb128-483"><a href="#cb128-483" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(oo_standardized3)</span>
<span id="cb128-484"><a href="#cb128-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-485"><a href="#cb128-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-486"><a href="#cb128-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-487"><a href="#cb128-487" aria-hidden="true" tabindex="-1"></a>Best solution is to vectorize the procedure and use the APPLY type statements.</span>
<span id="cb128-488"><a href="#cb128-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-489"><a href="#cb128-489" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`apply()`</span> used to apply functions over the indices of an array.</span>
<span id="cb128-490"><a href="#cb128-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-491"><a href="#cb128-491" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`lapply()`</span> used to apply functions over the values in a list, outputs to a list.</span>
<span id="cb128-492"><a href="#cb128-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-493"><a href="#cb128-493" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`sapply()`</span> used to apply functions over the values in a list, outputs to a simplified array.</span>
<span id="cb128-494"><a href="#cb128-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-495"><a href="#cb128-495" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`lapply()`</span> and <span class="in">`sapply(simplify = FALSE)`</span> are the same thing, kinda how <span class="in">`paste()`</span> and <span class="in">`paste0()`</span> are the same except <span class="in">`paste0()`</span> has a default separator (which is very useful, so they just gave it a shorthand function).</span>
<span id="cb128-496"><a href="#cb128-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-497"><a href="#cb128-497" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`vapply()`</span> used to apply functions over the values in a list, outputs to specified object type.</span>
<span id="cb128-498"><a href="#cb128-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-499"><a href="#cb128-499" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`mapply()`</span> used to apply functions over the corresponding values in multiple lists.</span>
<span id="cb128-500"><a href="#cb128-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-501"><a href="#cb128-501" aria-hidden="true" tabindex="-1"></a>Karsten's Personal Use (with orders of magnitude &gt;): <span class="in">`sapply`</span> $&gt;$ <span class="in">`lapply`</span> $&gt;&gt;$ <span class="in">`mapply`</span> $&gt;&gt;$ <span class="in">`vapply`</span> $&gt;&gt;$ <span class="in">`apply`</span></span>
<span id="cb128-502"><a href="#cb128-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-505"><a href="#cb128-505" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-506"><a href="#cb128-506" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-change-to-functions-apply</span></span>
<span id="cb128-507"><a href="#cb128-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-508"><a href="#cb128-508" aria-hidden="true" tabindex="-1"></a><span class="co"># loop over all column names with sapply()</span></span>
<span id="cb128-509"><a href="#cb128-509" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; typically in practice the formals are given implicitly and just know that the object to be looped over is first and the function being applied is second</span></span>
<span id="cb128-510"><a href="#cb128-510" aria-hidden="true" tabindex="-1"></a>oo_better <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="at">X =</span> acids, <span class="at">FUN =</span> oo_stand) <span class="sc">%&gt;%</span> as.data.frame</span>
<span id="cb128-511"><a href="#cb128-511" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(better_oo)</span>
<span id="cb128-512"><a href="#cb128-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-513"><a href="#cb128-513" aria-hidden="true" tabindex="-1"></a><span class="co"># same thing, but return object is a list</span></span>
<span id="cb128-514"><a href="#cb128-514" aria-hidden="true" tabindex="-1"></a>oo_better_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="at">X =</span> acids, <span class="at">FUN =</span> oo_stand)</span>
<span id="cb128-515"><a href="#cb128-515" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(oo_better_list)</span>
<span id="cb128-516"><a href="#cb128-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-517"><a href="#cb128-517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-518"><a href="#cb128-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-519"><a href="#cb128-519" aria-hidden="true" tabindex="-1"></a>Can use tidyverse equivalents from the <span class="in">`purrr`</span> package (<span class="co">[</span><span class="ot">documentation</span><span class="co">](http://purrr.tidyverse.org)</span>), specifically <span class="in">`map()`</span>.</span>
<span id="cb128-520"><a href="#cb128-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-521"><a href="#cb128-521" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`map()`</span> always returns a list, so this would be equivalent <span class="in">`lapply()`</span>.</span>
<span id="cb128-522"><a href="#cb128-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-523"><a href="#cb128-523" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Other variants include:</span>
<span id="cb128-524"><a href="#cb128-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-525"><a href="#cb128-525" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`map_vec()`</span> must return a single value from each operation. If you know the output type, it is more efficient to use the corresponding variant such as <span class="in">`map_dbl()`</span>, <span class="in">`map_chr()`</span>, etc.</span>
<span id="cb128-526"><a href="#cb128-526" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-527"><a href="#cb128-527" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>indexed map <span class="in">`imap()`</span> applies a function to each element of a vector, and its index (which is shorthand for a particular use of <span class="in">`map2()`</span> which iterates over 2 arguments at a time).</span>
<span id="cb128-528"><a href="#cb128-528" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-529"><a href="#cb128-529" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`lmap()`</span> applies a function to list-elements of a list, useful for applying functions that take lists as arguments.</span>
<span id="cb128-530"><a href="#cb128-530" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-531"><a href="#cb128-531" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`pmap()`</span> extends <span class="in">`map2()`</span> to iterate over multiple arguments simultaneously.</span>
<span id="cb128-532"><a href="#cb128-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-535"><a href="#cb128-535" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-536"><a href="#cb128-536" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-change-to-functions-map</span></span>
<span id="cb128-537"><a href="#cb128-537" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb128-538"><a href="#cb128-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-539"><a href="#cb128-539" aria-hidden="true" tabindex="-1"></a><span class="co"># loop over all column names with sapply()</span></span>
<span id="cb128-540"><a href="#cb128-540" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb128-541"><a href="#cb128-541" aria-hidden="true" tabindex="-1"></a><span class="co">#  </span></span>
<span id="cb128-542"><a href="#cb128-542" aria-hidden="true" tabindex="-1"></a><span class="co"># help(package="purrr")</span></span>
<span id="cb128-543"><a href="#cb128-543" aria-hidden="true" tabindex="-1"></a><span class="co"># ?map</span></span>
<span id="cb128-544"><a href="#cb128-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-545"><a href="#cb128-545" aria-hidden="true" tabindex="-1"></a><span class="co"># apply same function over names of columns using purrr equivalent function to lapply</span></span>
<span id="cb128-546"><a href="#cb128-546" aria-hidden="true" tabindex="-1"></a>oo_purrr_list <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="at">.x =</span> acids, <span class="at">.f =</span> oo_stand)</span>
<span id="cb128-547"><a href="#cb128-547" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(oo_purrr_list)</span>
<span id="cb128-548"><a href="#cb128-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-549"><a href="#cb128-549" aria-hidden="true" tabindex="-1"></a><span class="co"># same thing, but now simplify the result</span></span>
<span id="cb128-550"><a href="#cb128-550" aria-hidden="true" tabindex="-1"></a><span class="fu">map_vec</span>(<span class="at">.x =</span> acids, <span class="at">.f =</span> oo_stand)</span>
<span id="cb128-551"><a href="#cb128-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-552"><a href="#cb128-552" aria-hidden="true" tabindex="-1"></a><span class="co"># modify function to just return the st dev of the standardized columns</span></span>
<span id="cb128-553"><a href="#cb128-553" aria-hidden="true" tabindex="-1"></a>oo_stand_sd <span class="ot">&lt;-</span> <span class="cf">function</span>(varname) {</span>
<span id="cb128-554"><a href="#cb128-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sd</span>((oliveoil[,varname]<span class="sc">-</span><span class="fu">mean</span>(oliveoil[,varname]))<span class="sc">/</span><span class="fu">sd</span>(oliveoil[,varname]))</span>
<span id="cb128-555"><a href="#cb128-555" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-556"><a href="#cb128-556" aria-hidden="true" tabindex="-1"></a><span class="fu">map_vec</span>(<span class="at">.x =</span> acids, <span class="at">.f =</span> oo_stand_sd)</span>
<span id="cb128-557"><a href="#cb128-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-558"><a href="#cb128-558" aria-hidden="true" tabindex="-1"></a><span class="co"># know returning a double, so use map_dbl()</span></span>
<span id="cb128-559"><a href="#cb128-559" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(<span class="at">.x =</span> acids, <span class="at">.f =</span> oo_stand_sd)</span>
<span id="cb128-560"><a href="#cb128-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-561"><a href="#cb128-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-562"><a href="#cb128-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-563"><a href="#cb128-563" aria-hidden="true" tabindex="-1"></a>Mini timing study to see which method of looping is most efficient.</span>
<span id="cb128-564"><a href="#cb128-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-565"><a href="#cb128-565" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>APPLY statements are quicker than for because they are run in C rather than R.</span>
<span id="cb128-566"><a href="#cb128-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-569"><a href="#cb128-569" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-570"><a href="#cb128-570" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: timing</span></span>
<span id="cb128-571"><a href="#cb128-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-572"><a href="#cb128-572" aria-hidden="true" tabindex="-1"></a><span class="co"># create lots of lm from different random samples and store the slope of a particular variable</span></span>
<span id="cb128-573"><a href="#cb128-573" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb128-574"><a href="#cb128-574" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb128-575"><a href="#cb128-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-576"><a href="#cb128-576" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize timing study and use for loop</span></span>
<span id="cb128-577"><a href="#cb128-577" aria-hidden="true" tabindex="-1"></a>timer_for <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb128-578"><a href="#cb128-578" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb128-579"><a href="#cb128-579" aria-hidden="true" tabindex="-1"></a>  betas[i] <span class="ot">&lt;-</span> <span class="fu">lm</span>(palmitic <span class="sc">~</span> . , <span class="at">data =</span> <span class="fu">slice_sample</span>(oliveoil, <span class="at">n =</span> <span class="dv">100</span>))<span class="sc">$</span>coefficients[<span class="st">"oleic"</span>]</span>
<span id="cb128-580"><a href="#cb128-580" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-581"><a href="#cb128-581" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>() <span class="sc">-</span> timer_for</span>
<span id="cb128-582"><a href="#cb128-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-583"><a href="#cb128-583" aria-hidden="true" tabindex="-1"></a><span class="co"># now use sapply()</span></span>
<span id="cb128-584"><a href="#cb128-584" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; again not really using X = 1:n in the function that sapply() calls, it is just for the iterations to do the thing that many times</span></span>
<span id="cb128-585"><a href="#cb128-585" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb128-586"><a href="#cb128-586" aria-hidden="true" tabindex="-1"></a>timer_sapply <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb128-587"><a href="#cb128-587" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="cf">function</span>(x) {</span>
<span id="cb128-588"><a href="#cb128-588" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(palmitic <span class="sc">~</span> . , <span class="at">data =</span> <span class="fu">slice_sample</span>(oliveoil, <span class="at">n =</span> <span class="dv">100</span>))<span class="sc">$</span>coefficients[<span class="st">"oleic"</span>]</span>
<span id="cb128-589"><a href="#cb128-589" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb128-590"><a href="#cb128-590" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>() <span class="sc">-</span> timer_sapply</span>
<span id="cb128-591"><a href="#cb128-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-592"><a href="#cb128-592" aria-hidden="true" tabindex="-1"></a><span class="co"># now use map()</span></span>
<span id="cb128-593"><a href="#cb128-593" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb128-594"><a href="#cb128-594" aria-hidden="true" tabindex="-1"></a>timer_map <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb128-595"><a href="#cb128-595" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>n, \(x) <span class="fu">lm</span>(palmitic <span class="sc">~</span> . , <span class="at">data =</span> <span class="fu">slice_sample</span>(oliveoil, <span class="at">n =</span> <span class="dv">100</span>))<span class="sc">$</span>coefficients[<span class="st">"oleic"</span>])</span>
<span id="cb128-596"><a href="#cb128-596" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>() <span class="sc">-</span> timer_map</span>
<span id="cb128-597"><a href="#cb128-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-598"><a href="#cb128-598" aria-hidden="true" tabindex="-1"></a><span class="co"># now use map_dbl()</span></span>
<span id="cb128-599"><a href="#cb128-599" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb128-600"><a href="#cb128-600" aria-hidden="true" tabindex="-1"></a>timer_dbl <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb128-601"><a href="#cb128-601" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span>n, \(x) <span class="fu">lm</span>(palmitic <span class="sc">~</span> . , <span class="at">data =</span> <span class="fu">slice_sample</span>(oliveoil, <span class="at">n =</span> <span class="dv">100</span>))<span class="sc">$</span>coefficients[<span class="st">"oleic"</span>])</span>
<span id="cb128-602"><a href="#cb128-602" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>() <span class="sc">-</span> timer_dbl</span>
<span id="cb128-603"><a href="#cb128-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-604"><a href="#cb128-604" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-605"><a href="#cb128-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-606"><a href="#cb128-606" aria-hidden="true" tabindex="-1"></a><span class="fu">## Applying functions over multiple sets of parameters</span></span>
<span id="cb128-607"><a href="#cb128-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-608"><a href="#cb128-608" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simulate data </span></span>
<span id="cb128-609"><a href="#cb128-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-610"><a href="#cb128-610" aria-hidden="true" tabindex="-1"></a>In some cases we may wish to apply a complex function by putting in multiple sets of arguments and collecting the results. In the example below we explore a simple case where we want to gather simulated values from a beta distribution with several different shape parameter ($\alpha$, $\beta$) pairs.</span>
<span id="cb128-611"><a href="#cb128-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-614"><a href="#cb128-614" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-615"><a href="#cb128-615" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: multiple-param-beta</span></span>
<span id="cb128-616"><a href="#cb128-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-617"><a href="#cb128-617" aria-hidden="true" tabindex="-1"></a><span class="co"># let's check what the rbeta() function does first in the help menu</span></span>
<span id="cb128-618"><a href="#cb128-618" aria-hidden="true" tabindex="-1"></a><span class="co"># ?rbeta</span></span>
<span id="cb128-619"><a href="#cb128-619" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate n observations from a specific beta distribution</span></span>
<span id="cb128-620"><a href="#cb128-620" aria-hidden="true" tabindex="-1"></a><span class="fu">rbeta</span>(<span class="dv">5</span>, <span class="at">shape1 =</span> <span class="dv">1</span>, <span class="at">shape2 =</span> <span class="dv">1</span>)</span>
<span id="cb128-621"><a href="#cb128-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-622"><a href="#cb128-622" aria-hidden="true" tabindex="-1"></a><span class="co"># want to apply the rbeta() function over all 100 unique combinations</span></span>
<span id="cb128-623"><a href="#cb128-623" aria-hidden="true" tabindex="-1"></a><span class="co"># of shape1 = {0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5}</span></span>
<span id="cb128-624"><a href="#cb128-624" aria-hidden="true" tabindex="-1"></a><span class="co"># and shape2 = {0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5}</span></span>
<span id="cb128-625"><a href="#cb128-625" aria-hidden="true" tabindex="-1"></a>param_combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">shape1 =</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.5</span>),</span>
<span id="cb128-626"><a href="#cb128-626" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">shape2 =</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.5</span>))</span>
<span id="cb128-627"><a href="#cb128-627" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(param_combinations)</span>
<span id="cb128-628"><a href="#cb128-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-629"><a href="#cb128-629" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-630"><a href="#cb128-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-631"><a href="#cb128-631" aria-hidden="true" tabindex="-1"></a>Could create two nested for loops to iterate over these pairs and store as it loops, but that is messy. Instead we will iterate over each pair using <span class="in">`mapply()`</span> and <span class="in">`map2()`</span>.</span>
<span id="cb128-632"><a href="#cb128-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-635"><a href="#cb128-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-636"><a href="#cb128-636" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: iterate-multiple-args</span></span>
<span id="cb128-637"><a href="#cb128-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-638"><a href="#cb128-638" aria-hidden="true" tabindex="-1"></a><span class="co"># run simulation to generate 5 values beta values from each parameter combo</span></span>
<span id="cb128-639"><a href="#cb128-639" aria-hidden="true" tabindex="-1"></a><span class="co"># use mapply() and simplify the result</span></span>
<span id="cb128-640"><a href="#cb128-640" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb128-641"><a href="#cb128-641" aria-hidden="true" tabindex="-1"></a>my_beta_sims <span class="ot">&lt;-</span> <span class="fu">mapply</span>(<span class="at">FUN =</span> rbeta, </span>
<span id="cb128-642"><a href="#cb128-642" aria-hidden="true" tabindex="-1"></a>                       <span class="at">shape1 =</span> param_combinations<span class="sc">$</span>shape1,</span>
<span id="cb128-643"><a href="#cb128-643" aria-hidden="true" tabindex="-1"></a>                       <span class="at">shape2 =</span> param_combinations<span class="sc">$</span>shape2,</span>
<span id="cb128-644"><a href="#cb128-644" aria-hidden="true" tabindex="-1"></a>                       <span class="at">MoreArgs =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">5</span>),</span>
<span id="cb128-645"><a href="#cb128-645" aria-hidden="true" tabindex="-1"></a>                       <span class="at">SIMPLIFY =</span> <span class="st">"array"</span>)</span>
<span id="cb128-646"><a href="#cb128-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-647"><a href="#cb128-647" aria-hidden="true" tabindex="-1"></a><span class="co"># map way shown at end</span></span>
<span id="cb128-648"><a href="#cb128-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-649"><a href="#cb128-649" aria-hidden="true" tabindex="-1"></a><span class="co"># rows in parameter storage correspond to the columns in the simulation array</span></span>
<span id="cb128-650"><a href="#cb128-650" aria-hidden="true" tabindex="-1"></a>param_combinations[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb128-651"><a href="#cb128-651" aria-hidden="true" tabindex="-1"></a>my_beta_sims[,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb128-652"><a href="#cb128-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-653"><a href="#cb128-653" aria-hidden="true" tabindex="-1"></a><span class="co"># use map2()</span></span>
<span id="cb128-654"><a href="#cb128-654" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; returns a list, so have to reduce it to turn into a matrix and then set the colnames to be readable</span></span>
<span id="cb128-655"><a href="#cb128-655" aria-hidden="true" tabindex="-1"></a>my_beta_sims <span class="ot">&lt;-</span> param_combinations <span class="sc">%&gt;%</span> </span>
<span id="cb128-656"><a href="#cb128-656" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">map2</span>(.<span class="sc">$</span>shape1, .<span class="sc">$</span>shape2,</span>
<span id="cb128-657"><a href="#cb128-657" aria-hidden="true" tabindex="-1"></a>       \(shape1, shape2) <span class="fu">rbeta</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">shape1 =</span> shape1, <span class="at">shape2 =</span> shape2))} <span class="sc">%&gt;%</span> </span>
<span id="cb128-658"><a href="#cb128-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(cbind)</span>
<span id="cb128-659"><a href="#cb128-659" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(my_beta_sims) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"sim"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(param_combinations))</span>
<span id="cb128-660"><a href="#cb128-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-661"><a href="#cb128-661" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-662"><a href="#cb128-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-663"><a href="#cb128-663" aria-hidden="true" tabindex="-1"></a>Or even better organization is to turn this into an 3-dimensional array where the index <span class="in">`[i,j,k]`</span> represent the $i$th simulation, $j$th <span class="in">`shape1`</span>, and $k$-th <span class="in">`shape2`</span>.</span>
<span id="cb128-664"><a href="#cb128-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-667"><a href="#cb128-667" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-668"><a href="#cb128-668" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: array</span></span>
<span id="cb128-669"><a href="#cb128-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-670"><a href="#cb128-670" aria-hidden="true" tabindex="-1"></a><span class="co"># convert copy of matrix to array (remember )</span></span>
<span id="cb128-671"><a href="#cb128-671" aria-hidden="true" tabindex="-1"></a>my_beta_sims_array <span class="ot">&lt;-</span> my_beta_sims</span>
<span id="cb128-672"><a href="#cb128-672" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(my_beta_sims_array) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb128-673"><a href="#cb128-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-674"><a href="#cb128-674" aria-hidden="true" tabindex="-1"></a><span class="co"># remember R goes down the columns first to fill the first layer</span></span>
<span id="cb128-675"><a href="#cb128-675" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; then starts the next layer down the columns....</span></span>
<span id="cb128-676"><a href="#cb128-676" aria-hidden="true" tabindex="-1"></a>my_beta_sims_array[ , , <span class="dv">1</span>] <span class="sc">==</span> my_beta_sims[, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb128-677"><a href="#cb128-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-678"><a href="#cb128-678" aria-hidden="true" tabindex="-1"></a><span class="co"># display all simulations from the first shape 2 (columns = simulation and rows = iteration)</span></span>
<span id="cb128-679"><a href="#cb128-679" aria-hidden="true" tabindex="-1"></a>my_beta_sims_array[ , , <span class="dv">1</span>]</span>
<span id="cb128-680"><a href="#cb128-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-681"><a href="#cb128-681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-682"><a href="#cb128-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-683"><a href="#cb128-683" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summarize simulation </span></span>
<span id="cb128-684"><a href="#cb128-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-685"><a href="#cb128-685" aria-hidden="true" tabindex="-1"></a>Now suppose we want the mean for the simulation outcomes array. Use <span class="in">`apply()`</span> to iterate over indices of the array.</span>
<span id="cb128-686"><a href="#cb128-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-689"><a href="#cb128-689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-690"><a href="#cb128-690" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: functions-on-array</span></span>
<span id="cb128-691"><a href="#cb128-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-692"><a href="#cb128-692" aria-hidden="true" tabindex="-1"></a><span class="co"># calc mean of a particular iteration</span></span>
<span id="cb128-693"><a href="#cb128-693" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(my_beta_sims_array[ ,<span class="dv">1</span> , <span class="dv">1</span>])</span>
<span id="cb128-694"><a href="#cb128-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-695"><a href="#cb128-695" aria-hidden="true" tabindex="-1"></a><span class="co"># loop over each column in each layer (thus averaging over the rows) with apply()</span></span>
<span id="cb128-696"><a href="#cb128-696" aria-hidden="true" tabindex="-1"></a>beta_means <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="at">X =</span> my_beta_sims_array,</span>
<span id="cb128-697"><a href="#cb128-697" aria-hidden="true" tabindex="-1"></a>                    <span class="at">MARGIN =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb128-698"><a href="#cb128-698" aria-hidden="true" tabindex="-1"></a>                    <span class="at">FUN =</span> mean)</span>
<span id="cb128-699"><a href="#cb128-699" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(beta_means)</span>
<span id="cb128-700"><a href="#cb128-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-701"><a href="#cb128-701" aria-hidden="true" tabindex="-1"></a><span class="co"># map way requires different functions</span></span>
<span id="cb128-702"><a href="#cb128-702" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; need to convert the array to a list first with array_tree() (a hierarchical list), and then map at the second level</span></span>
<span id="cb128-703"><a href="#cb128-703" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; then simplify</span></span>
<span id="cb128-704"><a href="#cb128-704" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co"> -&gt; changing the order of dimensions in MARGIN transposes the result (i.e. order matters)</span></span>
<span id="cb128-705"><a href="#cb128-705" aria-hidden="true" tabindex="-1"></a>beta_means2 <span class="ot">&lt;-</span> my_beta_sims_array <span class="sc">%&gt;%</span> </span>
<span id="cb128-706"><a href="#cb128-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">array_tree</span>(<span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> <span class="co"># first level list will be the layers, then the columns result$layer[[column]]</span></span>
<span id="cb128-707"><a href="#cb128-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_depth</span>(<span class="at">.depth =</span> <span class="dv">2</span>, <span class="at">.f =</span> mean) <span class="sc">%&gt;%</span> </span>
<span id="cb128-708"><a href="#cb128-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(cbind)</span>
<span id="cb128-709"><a href="#cb128-709" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(beta_means2) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"shape1_"</span>, <span class="fu">unique</span>(param_combinations<span class="sc">$</span>shape1))</span>
<span id="cb128-710"><a href="#cb128-710" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(beta_means2) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"shape2_"</span>, <span class="fu">unique</span>(param_combinations<span class="sc">$</span>shape2))</span>
<span id="cb128-711"><a href="#cb128-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-712"><a href="#cb128-712" aria-hidden="true" tabindex="-1"></a><span class="co"># compare two different methods</span></span>
<span id="cb128-713"><a href="#cb128-713" aria-hidden="true" tabindex="-1"></a>beta_means2 <span class="sc">==</span> beta_means</span>
<span id="cb128-714"><a href="#cb128-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-715"><a href="#cb128-715" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-716"><a href="#cb128-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-717"><a href="#cb128-717" aria-hidden="true" tabindex="-1"></a>Now we can check our simulated means against a theoretical mean: $X \sim \text{beta}(\alpha, \beta) \Longrightarrow E(X) = \frac{\alpha}{\alpha + \beta}$.</span>
<span id="cb128-718"><a href="#cb128-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-721"><a href="#cb128-721" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-722"><a href="#cb128-722" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-means</span></span>
<span id="cb128-723"><a href="#cb128-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-724"><a href="#cb128-724" aria-hidden="true" tabindex="-1"></a><span class="co"># define function to calculate theoretical beta mean</span></span>
<span id="cb128-725"><a href="#cb128-725" aria-hidden="true" tabindex="-1"></a>theoretical_beta_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha, beta){</span>
<span id="cb128-726"><a href="#cb128-726" aria-hidden="true" tabindex="-1"></a>  alpha <span class="sc">/</span> (alpha <span class="sc">+</span> beta)</span>
<span id="cb128-727"><a href="#cb128-727" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-728"><a href="#cb128-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-729"><a href="#cb128-729" aria-hidden="true" tabindex="-1"></a><span class="co"># create a 10 x 10 matrix of the theoretical means for the beta distribution using the function above</span></span>
<span id="cb128-730"><a href="#cb128-730" aria-hidden="true" tabindex="-1"></a>theoretical_means <span class="ot">&lt;-</span> <span class="fu">mapply</span>(<span class="at">FUN =</span> theoretical_beta_mean,</span>
<span id="cb128-731"><a href="#cb128-731" aria-hidden="true" tabindex="-1"></a>                            <span class="at">alpha =</span> param_combinations<span class="sc">$</span>shape1,</span>
<span id="cb128-732"><a href="#cb128-732" aria-hidden="true" tabindex="-1"></a>                            <span class="at">beta =</span> param_combinations<span class="sc">$</span>shape2,</span>
<span id="cb128-733"><a href="#cb128-733" aria-hidden="true" tabindex="-1"></a>                            <span class="at">SIMPLIFY =</span> <span class="st">"array"</span>)</span>
<span id="cb128-734"><a href="#cb128-734" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(theoretical_means) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb128-735"><a href="#cb128-735" aria-hidden="true" tabindex="-1"></a>theoretical_means</span>
<span id="cb128-736"><a href="#cb128-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-737"><a href="#cb128-737" aria-hidden="true" tabindex="-1"></a><span class="co"># now use map2, then simplify to vector and convert to matrix</span></span>
<span id="cb128-738"><a href="#cb128-738" aria-hidden="true" tabindex="-1"></a>theoretical_means2 <span class="ot">&lt;-</span> param_combinations <span class="sc">%&gt;%</span> </span>
<span id="cb128-739"><a href="#cb128-739" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">map2</span>(.<span class="sc">$</span>shape1, .<span class="sc">$</span>shape2, \(alpha, beta) <span class="fu">theoretical_beta_mean</span>(alpha, beta))} <span class="sc">%&gt;%</span> </span>
<span id="cb128-740"><a href="#cb128-740" aria-hidden="true" tabindex="-1"></a>  as_vector</span>
<span id="cb128-741"><a href="#cb128-741" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(theoretical_means2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb128-742"><a href="#cb128-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-743"><a href="#cb128-743" aria-hidden="true" tabindex="-1"></a>theoretical_means <span class="sc">==</span> theoretical_means2</span>
<span id="cb128-744"><a href="#cb128-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-745"><a href="#cb128-745" aria-hidden="true" tabindex="-1"></a><span class="co"># compare a few means</span></span>
<span id="cb128-746"><a href="#cb128-746" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; note that for some reason beta_means2 is stored as a list but displaying like a matrix? but it is correct</span></span>
<span id="cb128-747"><a href="#cb128-747" aria-hidden="true" tabindex="-1"></a>theoretical_means[<span class="dv">2</span>,<span class="dv">7</span>] <span class="sc">-</span> beta_means2[<span class="dv">2</span>,<span class="dv">7</span>][[<span class="dv">1</span>]]</span>
<span id="cb128-748"><a href="#cb128-748" aria-hidden="true" tabindex="-1"></a>theoretical_means[<span class="dv">1</span>,<span class="dv">10</span>] <span class="sc">-</span> beta_means2[<span class="dv">1</span>,<span class="dv">10</span>][[<span class="dv">1</span>]]</span>
<span id="cb128-749"><a href="#cb128-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-750"><a href="#cb128-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-751"><a href="#cb128-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-752"><a href="#cb128-752" aria-hidden="true" tabindex="-1"></a><span class="fu">### Entire workflow </span></span>
<span id="cb128-753"><a href="#cb128-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-754"><a href="#cb128-754" aria-hidden="true" tabindex="-1"></a>To confirm the simulated data is correct, we can do a bigger simulation (more iterations) and then compare to the theoretical means.</span>
<span id="cb128-755"><a href="#cb128-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-758"><a href="#cb128-758" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-759"><a href="#cb128-759" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: entire-workflow</span></span>
<span id="cb128-760"><a href="#cb128-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-761"><a href="#cb128-761" aria-hidden="true" tabindex="-1"></a><span class="co"># steps of simulation</span></span>
<span id="cb128-762"><a href="#cb128-762" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; simulate data based on parameter combinations</span></span>
<span id="cb128-763"><a href="#cb128-763" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; keep in list form where each list all the iterations for a parameter pair</span></span>
<span id="cb128-764"><a href="#cb128-764" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; then unpack and convert to 10 x 10 matrix</span></span>
<span id="cb128-765"><a href="#cb128-765" aria-hidden="true" tabindex="-1"></a>beta_simulation <span class="ot">&lt;-</span> param_combinations <span class="sc">%&gt;%</span> </span>
<span id="cb128-766"><a href="#cb128-766" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">map2</span>(.<span class="sc">$</span>shape1, .<span class="sc">$</span>shape2, \(shape1, shape2) <span class="fu">rbeta</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">shape1 =</span> shape1, <span class="at">shape2 =</span> shape2))} <span class="sc">%&gt;%</span> </span>
<span id="cb128-767"><a href="#cb128-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(mean) <span class="sc">%&gt;%</span> </span>
<span id="cb128-768"><a href="#cb128-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(rbind)</span>
<span id="cb128-769"><a href="#cb128-769" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(beta_simulation) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb128-770"><a href="#cb128-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-771"><a href="#cb128-771" aria-hidden="true" tabindex="-1"></a><span class="co"># compare simulated and theoretical means</span></span>
<span id="cb128-772"><a href="#cb128-772" aria-hidden="true" tabindex="-1"></a>theoretical_means <span class="sc">-</span> beta_simulation</span>
<span id="cb128-773"><a href="#cb128-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-774"><a href="#cb128-774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-775"><a href="#cb128-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-776"><a href="#cb128-776" aria-hidden="true" tabindex="-1"></a><span class="fu">## Writing Modular Functions</span></span>
<span id="cb128-777"><a href="#cb128-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-778"><a href="#cb128-778" aria-hidden="true" tabindex="-1"></a>When you are writing functions to do a complex task, try to identify the system of simple tasks that are needed to accomplish it step-by-step. For example we might consider building functions to help us to automate the process of running stepwise selection based on AIC, then outputting a model object that we can use for prediction, or inference. </span>
<span id="cb128-779"><a href="#cb128-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-780"><a href="#cb128-780" aria-hidden="true" tabindex="-1"></a>We might initially think of one big function that can take a model matrix, X, and does a bunch of linear algebra to get beta estimates, calculates an AIC for the fitted model, then removes a columns from X to reduce the model... and repeat... a lot. Is that what we find inside the <span class="in">`step()`</span> function? Run <span class="in">`body(step)`</span> to see.</span>
<span id="cb128-781"><a href="#cb128-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-782"><a href="#cb128-782" aria-hidden="true" tabindex="-1"></a>It isn't doing any of the linear algebra and AIC calculations we expected! The body of the step function is filled with, well more functions! It is function pinata!</span>
<span id="cb128-783"><a href="#cb128-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-784"><a href="#cb128-784" aria-hidden="true" tabindex="-1"></a>What we find is that the <span class="in">`step()`</span> function calls many other functions to do the individual smaller tasks that make up the complex procedure. If we search closely, there is a function for dropping a row, <span class="in">`drop1()`</span>, within a <span class="in">`while`</span> loop that keeps dropping rows until a condition is met. There is a function for updating the fit of the model, <span class="in">`update()`</span>, and calculating the AIC, <span class="in">`extractAIC()`</span>. There is even a function created at the start of the body that are used to help organize and return a helpful print statement about the stepwise procedure: <span class="in">`step.results()`</span>. </span>
<span id="cb128-785"><a href="#cb128-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-786"><a href="#cb128-786" aria-hidden="true" tabindex="-1"></a>These functions are often times called "helper functions", completing the sub-tasks of the primary function. This modular format allows each function to complete a single simple task, and when used in combination, achieve a complex task. </span>
<span id="cb128-787"><a href="#cb128-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-788"><a href="#cb128-788" aria-hidden="true" tabindex="-1"></a>Thus, when modularizing code, the end goal to have one "overall" function that just has some helper functions within. On the way to having modularized code, is it better to start with an overall function and add modules sequentially (so e.g. if we call the overall, it will call module 1, so we check if that works; then add module 2 and call the overall which runs mod 1 and mod 2).... etc.</span>
<span id="cb128-789"><a href="#cb128-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-790"><a href="#cb128-790" aria-hidden="true" tabindex="-1"></a>Below is an example (NOT RUN) to demostrate how helper functions can be used so that the overall function is body is relatively simple, all the work is being done by other functions. The overall function should be readable step by step.</span>
<span id="cb128-791"><a href="#cb128-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-794"><a href="#cb128-794" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-795"><a href="#cb128-795" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: helper-functions</span></span>
<span id="cb128-796"><a href="#cb128-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb128-797"><a href="#cb128-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-798"><a href="#cb128-798" aria-hidden="true" tabindex="-1"></a><span class="co"># main data simulation function</span></span>
<span id="cb128-799"><a href="#cb128-799" aria-hidden="true" tabindex="-1"></a><span class="co"># write a function to simulate a dataset for an n x p dataset for a regression model where q of the variables are inactive (signal variables)</span></span>
<span id="cb128-800"><a href="#cb128-800" aria-hidden="true" tabindex="-1"></a>make_sim_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">p =</span> <span class="dv">20</span>, <span class="at">q =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="fl">0.1</span>, <span class="at">sd_y =</span> <span class="dv">1</span>, <span class="at">sd_x =</span> <span class="dv">1</span>){</span>
<span id="cb128-801"><a href="#cb128-801" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-802"><a href="#cb128-802" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate a n(iteration in sample) x p(sample) matrix from rnorm(0, sd_X)</span></span>
<span id="cb128-803"><a href="#cb128-803" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">=</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>p, <span class="cf">function</span>(i) <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="at">sd =</span> sd_x))</span>
<span id="cb128-804"><a href="#cb128-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(X) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"x"</span>,<span class="dv">1</span><span class="sc">:</span>p)</span>
<span id="cb128-805"><a href="#cb128-805" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-806"><a href="#cb128-806" aria-hidden="true" tabindex="-1"></a>  <span class="co"># specify population coefficients</span></span>
<span id="cb128-807"><a href="#cb128-807" aria-hidden="true" tabindex="-1"></a>  betas <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(b, q), <span class="fu">rep</span>(<span class="dv">0</span>, p<span class="sc">-</span>q))</span>
<span id="cb128-808"><a href="#cb128-808" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-809"><a href="#cb128-809" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate responses</span></span>
<span id="cb128-810"><a href="#cb128-810" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> (X <span class="sc">%*%</span> betas)[,<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>, sd_y)</span>
<span id="cb128-811"><a href="#cb128-811" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-812"><a href="#cb128-812" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combine data</span></span>
<span id="cb128-813"><a href="#cb128-813" aria-hidden="true" tabindex="-1"></a>  sim_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(y,X)</span>
<span id="cb128-814"><a href="#cb128-814" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-815"><a href="#cb128-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sim_data)</span>
<span id="cb128-816"><a href="#cb128-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-817"><a href="#cb128-817" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-818"><a href="#cb128-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-819"><a href="#cb128-819" aria-hidden="true" tabindex="-1"></a><span class="co"># helper functions for running the experiment with variable selection</span></span>
<span id="cb128-820"><a href="#cb128-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-821"><a href="#cb128-821" aria-hidden="true" tabindex="-1"></a><span class="co"># function for choosing with stepwise and fitting a regression</span></span>
<span id="cb128-822"><a href="#cb128-822" aria-hidden="true" tabindex="-1"></a>step_var_mod <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb128-823"><a href="#cb128-823" aria-hidden="true" tabindex="-1"></a>  step_selected <span class="ot">&lt;-</span> <span class="fu">step</span>(<span class="fu">lm</span>(y <span class="sc">~</span> . , <span class="at">data =</span> df), <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb128-824"><a href="#cb128-824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(step_selected)</span>
<span id="cb128-825"><a href="#cb128-825" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-826"><a href="#cb128-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-827"><a href="#cb128-827" aria-hidden="true" tabindex="-1"></a><span class="co"># function for choosing with lasso and fitting regression</span></span>
<span id="cb128-828"><a href="#cb128-828" aria-hidden="true" tabindex="-1"></a>lasso_var_mod <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb128-829"><a href="#cb128-829" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-830"><a href="#cb128-830" aria-hidden="true" tabindex="-1"></a>  cv.out <span class="ot">=</span> <span class="fu">cv.glmnet</span>(<span class="at">x =</span> <span class="fu">as.matrix</span>(<span class="at">x =</span> df[ ,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(df) <span class="sc">==</span> <span class="st">"y"</span>)]),</span>
<span id="cb128-831"><a href="#cb128-831" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> df<span class="sc">$</span>y, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">type.measure =</span> <span class="st">"deviance"</span>)</span>
<span id="cb128-832"><a href="#cb128-832" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-833"><a href="#cb128-833" aria-hidden="true" tabindex="-1"></a>  lasso_mod <span class="ot">=</span> <span class="fu">glmnet</span>(<span class="at">x =</span> <span class="fu">as.matrix</span>(<span class="at">x =</span> df[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(df) <span class="sc">==</span> <span class="st">"y"</span>)]),</span>
<span id="cb128-834"><a href="#cb128-834" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> df<span class="sc">$</span>y, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">lambda =</span> cv.out<span class="sc">$</span>lambda<span class="fl">.1</span>se)</span>
<span id="cb128-835"><a href="#cb128-835" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-836"><a href="#cb128-836" aria-hidden="true" tabindex="-1"></a>  lasso_vars <span class="ot">=</span> <span class="fu">names</span>(lasso_mod<span class="sc">$</span>beta[,<span class="dv">1</span>])[<span class="fu">which</span>(lasso_mod<span class="sc">$</span>beta[,<span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>)]</span>
<span id="cb128-837"><a href="#cb128-837" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-838"><a href="#cb128-838" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(lasso_vars) <span class="sc">==</span> <span class="dv">0</span>) lasso_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(lasso_mod<span class="sc">$</span>beta[,<span class="dv">1</span>])[<span class="dv">1</span>]</span>
<span id="cb128-839"><a href="#cb128-839" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-840"><a href="#cb128-840" aria-hidden="true" tabindex="-1"></a>  lasso_selected <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">formula</span>(<span class="fu">paste0</span>(<span class="st">"y ~ 1 + "</span>, <span class="fu">paste</span>(lasso_vars, <span class="at">collapse =</span> <span class="st">" + "</span>))), <span class="at">data =</span> df)</span>
<span id="cb128-841"><a href="#cb128-841" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-842"><a href="#cb128-842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lasso_selected)</span>
<span id="cb128-843"><a href="#cb128-843" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-844"><a href="#cb128-844" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-845"><a href="#cb128-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-846"><a href="#cb128-846" aria-hidden="true" tabindex="-1"></a><span class="co"># function for finding number of variables included</span></span>
<span id="cb128-847"><a href="#cb128-847" aria-hidden="true" tabindex="-1"></a>select_var_count <span class="ot">&lt;-</span> <span class="cf">function</span>(lin_mod){</span>
<span id="cb128-848"><a href="#cb128-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(<span class="fu">coef</span>(lin_mod))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb128-849"><a href="#cb128-849" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-850"><a href="#cb128-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-851"><a href="#cb128-851" aria-hidden="true" tabindex="-1"></a><span class="co"># function for finding 10-fold cross validated RMSE</span></span>
<span id="cb128-852"><a href="#cb128-852" aria-hidden="true" tabindex="-1"></a>select_cv_rmse <span class="ot">&lt;-</span> <span class="cf">function</span>(lin_mod){</span>
<span id="cb128-853"><a href="#cb128-853" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-854"><a href="#cb128-854" aria-hidden="true" tabindex="-1"></a>  cv_result <span class="ot">=</span> <span class="fu">train</span>(<span class="fu">formula</span>(lin_mod), </span>
<span id="cb128-855"><a href="#cb128-855" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> lin_mod<span class="sc">$</span>model,</span>
<span id="cb128-856"><a href="#cb128-856" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb128-857"><a href="#cb128-857" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>),</span>
<span id="cb128-858"><a href="#cb128-858" aria-hidden="true" tabindex="-1"></a>    <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">intercept=</span><span class="cn">TRUE</span>))</span>
<span id="cb128-859"><a href="#cb128-859" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-860"><a href="#cb128-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cv_result<span class="sc">$</span>results<span class="sc">$</span>RMSE)</span>
<span id="cb128-861"><a href="#cb128-861" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-862"><a href="#cb128-862" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-863"><a href="#cb128-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-864"><a href="#cb128-864" aria-hidden="true" tabindex="-1"></a><span class="co"># function to run trial </span></span>
<span id="cb128-865"><a href="#cb128-865" aria-hidden="true" tabindex="-1"></a>run_trial <span class="ot">&lt;-</span> <span class="cf">function</span>(selection_alg, df){</span>
<span id="cb128-866"><a href="#cb128-866" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-867"><a href="#cb128-867" aria-hidden="true" tabindex="-1"></a>  start_time <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb128-868"><a href="#cb128-868" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-869"><a href="#cb128-869" aria-hidden="true" tabindex="-1"></a>  tmp_mod <span class="ot">=</span> <span class="fu">selection_alg</span>(df) <span class="co"># not sure where this function comes from</span></span>
<span id="cb128-870"><a href="#cb128-870" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-871"><a href="#cb128-871" aria-hidden="true" tabindex="-1"></a>  end_time <span class="ot">=</span> <span class="fu">Sys.time</span>()</span>
<span id="cb128-872"><a href="#cb128-872" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-873"><a href="#cb128-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">var_count =</span> <span class="fu">select_var_count</span>(tmp_mod),</span>
<span id="cb128-874"><a href="#cb128-874" aria-hidden="true" tabindex="-1"></a>                    <span class="at">rmse =</span> <span class="fu">select_cv_rmse</span>(tmp_mod), <span class="co"># nor this function</span></span>
<span id="cb128-875"><a href="#cb128-875" aria-hidden="true" tabindex="-1"></a>                    <span class="at">time =</span> <span class="fu">difftime</span>(end_time, start_time, <span class="at">units =</span> <span class="st">"secs"</span>)))</span>
<span id="cb128-876"><a href="#cb128-876" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-877"><a href="#cb128-877" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-878"><a href="#cb128-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-879"><a href="#cb128-879" aria-hidden="true" tabindex="-1"></a><span class="co"># make into a function of n_sims, n, p and q</span></span>
<span id="cb128-880"><a href="#cb128-880" aria-hidden="true" tabindex="-1"></a>sim_var_select <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_sim =</span> <span class="dv">10</span>, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">p =</span> <span class="dv">10</span>, <span class="at">q =</span> <span class="dv">5</span>, <span class="at">var_select_ftn =</span> step_var_mod){</span>
<span id="cb128-881"><a href="#cb128-881" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-882"><a href="#cb128-882" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb128-883"><a href="#cb128-883" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-884"><a href="#cb128-884" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim){</span>
<span id="cb128-885"><a href="#cb128-885" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-886"><a href="#cb128-886" aria-hidden="true" tabindex="-1"></a>    sim_data <span class="ot">&lt;-</span> <span class="fu">make_sim_data</span>(<span class="at">n =</span> n, <span class="at">p =</span> p,<span class="at">q =</span> q)</span>
<span id="cb128-887"><a href="#cb128-887" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-888"><a href="#cb128-888" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, <span class="fu">run_trial</span>(var_select_ftn, sim_data))</span>
<span id="cb128-889"><a href="#cb128-889" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-890"><a href="#cb128-890" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb128-891"><a href="#cb128-891" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-892"><a href="#cb128-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb128-893"><a href="#cb128-893" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-894"><a href="#cb128-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-895"><a href="#cb128-895" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>